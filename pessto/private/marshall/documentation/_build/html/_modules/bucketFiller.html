

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>bucketFiller &mdash; PESSTO Marshall 0.6.5 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="PESSTO Marshall 0.6.5 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../index.html">Dave Young's Python Documentation</a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>

          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/pessto_icon.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for bucketFiller</h1><div class="highlight"><pre>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">import</span> <span class="nn">csv</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">MySQLdb</span>
<span class="kn">import</span> <span class="nn">datetime</span>

<span class="c"># This enum code should be in utils.py</span>
<div class="viewcode-block" id="enum"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.enum">[docs]</a><span class="k">def</span> <span class="nf">enum</span><span class="p">(</span><span class="o">**</span><span class="n">enums</span><span class="p">):</span>
   <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="s">&#39;Enum&#39;</span><span class="p">,</span> <span class="p">(),</span> <span class="n">enums</span><span class="p">)</span>
</div>
<span class="n">SURVEYS</span> <span class="o">=</span> <span class="n">enum</span><span class="p">(</span><span class="n">LSQ</span><span class="o">=</span><span class="s">&#39;LSQ&#39;</span><span class="p">,</span> <span class="n">PS1</span><span class="o">=</span><span class="s">&#39;PS1&#39;</span><span class="p">,</span> <span class="n">CHASE</span><span class="o">=</span><span class="s">&#39;CHASE&#39;</span><span class="p">,</span> <span class="n">SMP</span><span class="o">=</span><span class="s">&#39;SMP&#39;</span><span class="p">,</span> <span class="n">PTF</span><span class="o">=</span><span class="s">&#39;PTF&#39;</span><span class="p">,</span> <span class="n">MASTER</span><span class="o">=</span><span class="s">&#39;MASTER&#39;</span><span class="p">,</span> <span class="n">CSS</span><span class="o">=</span><span class="s">&#39;CSS&#39;</span><span class="p">,</span> <span class="n">USERADDED</span><span class="o">=</span><span class="s">&#39;USERADDED&#39;</span><span class="p">)</span>

<span class="n">QUBLISTS</span> <span class="o">=</span> <span class="p">{</span>
   <span class="mi">0</span><span class="p">:</span><span class="s">&quot;GARBAGE&quot;</span><span class="p">,</span>
   <span class="mi">1</span><span class="p">:</span><span class="s">&quot;CONFIRMED&quot;</span><span class="p">,</span>
   <span class="mi">2</span><span class="p">:</span><span class="s">&quot;GOOD&quot;</span><span class="p">,</span>
   <span class="mi">3</span><span class="p">:</span><span class="s">&quot;POSSIBLE&quot;</span><span class="p">,</span>
   <span class="mi">4</span><span class="p">:</span><span class="s">&quot;EYEBALL&quot;</span><span class="p">,</span>
   <span class="mi">5</span><span class="p">:</span><span class="s">&quot;ATTIC&quot;</span><span class="p">,</span>
   <span class="mi">6</span><span class="p">:</span><span class="s">&quot;ZOO&quot;</span><span class="p">,</span>
   <span class="bp">None</span><span class="p">:</span><span class="s">&quot;UNLISTED&quot;</span>
<span class="p">}</span>


<div class="viewcode-block" id="getLSQSummaryRows"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.getLSQSummaryRows">[docs]</a><span class="k">def</span> <span class="nf">getLSQSummaryRows</span><span class="p">(</span><span class="n">dbConn</span><span class="p">):</span>

   <span class="k">try</span><span class="p">:</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbConn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>

      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span> <span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">         select *</span>
<span class="s">         from fs_lsq</span>
<span class="s">         where (summaryRow is true</span>
<span class="s">                and (ingested is true</span>
<span class="s">                and candidateID in (select distinct candidateID</span>
<span class="s">                                    from fs_lsq</span>
<span class="s">                                    where ingested is false)))</span>
<span class="s">         or (summaryRow is true</span>
<span class="s">             and ingested is false)</span>
<span class="s">         order by discDate</span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">)</span>

      <span class="n">resultSet</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span> <span class="p">()</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>

   <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">resultSet</span> <span class="o">=</span> <span class="p">()</span>

   <span class="k">return</span> <span class="n">resultSet</span>


</div>
<div class="viewcode-block" id="getLSQRecurrenceRows"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.getLSQRecurrenceRows">[docs]</a><span class="k">def</span> <span class="nf">getLSQRecurrenceRows</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">candidateID</span><span class="p">):</span>

   <span class="k">try</span><span class="p">:</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbConn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span> <span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">         select *</span>
<span class="s">         from fs_lsq</span>
<span class="s">         where candidateID = </span><span class="si">%s</span><span class="s"></span>
<span class="s">         and summaryRow is false</span>
<span class="s">         and ingested is false</span>
<span class="s">         order by observationJD</span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">candidateID</span><span class="p">))</span>

      <span class="n">resultSet</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span> <span class="p">()</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>

   <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">resultSet</span> <span class="o">=</span> <span class="p">()</span>

   <span class="k">return</span> <span class="n">resultSet</span>


</div>
<div class="viewcode-block" id="getPanstarrsSummaryRows"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.getPanstarrsSummaryRows">[docs]</a><span class="k">def</span> <span class="nf">getPanstarrsSummaryRows</span><span class="p">(</span><span class="n">dbConn</span><span class="p">):</span>

   <span class="k">try</span><span class="p">:</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbConn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>

      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span> <span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">         select *</span>
<span class="s">         from fs_panstarrs</span>
<span class="s">         where (summaryRow is true</span>
<span class="s">                and (ingested is true</span>
<span class="s">                and candidateID in (select distinct candidateID</span>
<span class="s">                                    from fs_panstarrs</span>
<span class="s">                                    where ingested is false)))</span>
<span class="s">         or (summaryRow is true</span>
<span class="s">             and ingested is false)</span>
<span class="s">         order by discDate</span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">)</span>

      <span class="n">resultSet</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span> <span class="p">()</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>

   <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">resultSet</span> <span class="o">=</span> <span class="p">()</span>

   <span class="k">return</span> <span class="n">resultSet</span>


</div>
<div class="viewcode-block" id="getPanstarrsRecurrenceRows"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.getPanstarrsRecurrenceRows">[docs]</a><span class="k">def</span> <span class="nf">getPanstarrsRecurrenceRows</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">candidateID</span><span class="p">):</span>

   <span class="k">try</span><span class="p">:</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbConn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span> <span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">         select *</span>
<span class="s">         from fs_panstarrs</span>
<span class="s">         where candidateID = </span><span class="si">%s</span><span class="s"></span>
<span class="s">         and summaryRow is false</span>
<span class="s">         and ingested is false</span>
<span class="s">         order by observationMJD</span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">candidateID</span><span class="p">))</span>

      <span class="n">resultSet</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span> <span class="p">()</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>

   <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">resultSet</span> <span class="o">=</span> <span class="p">()</span>

   <span class="k">return</span> <span class="n">resultSet</span>


</div>
<div class="viewcode-block" id="getChaseSummaryRows"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.getChaseSummaryRows">[docs]</a><span class="k">def</span> <span class="nf">getChaseSummaryRows</span><span class="p">(</span><span class="n">dbConn</span><span class="p">):</span>

   <span class="k">try</span><span class="p">:</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbConn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>

      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span> <span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">         select *</span>
<span class="s">         from fs_chase</span>
<span class="s">         where (summaryRow is true</span>
<span class="s">                and (ingested is true</span>
<span class="s">                and candidateID in (select distinct candidateID</span>
<span class="s">                                    from fs_chase</span>
<span class="s">                                    where ingested is false)))</span>
<span class="s">         or (summaryRow is true</span>
<span class="s">             and ingested is false)</span>
<span class="s">         order by discDate</span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">)</span>

      <span class="n">resultSet</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span> <span class="p">()</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>

   <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">resultSet</span> <span class="o">=</span> <span class="p">()</span>

   <span class="k">return</span> <span class="n">resultSet</span>

</div>
<div class="viewcode-block" id="getChaseRecurrenceRows"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.getChaseRecurrenceRows">[docs]</a><span class="k">def</span> <span class="nf">getChaseRecurrenceRows</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">candidateID</span><span class="p">):</span>

   <span class="k">try</span><span class="p">:</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbConn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span> <span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">         select *</span>
<span class="s">         from fs_chase</span>
<span class="s">         where candidateID = </span><span class="si">%s</span><span class="s"></span>
<span class="s">         and summaryRow is false</span>
<span class="s">         and ingested is false</span>
<span class="s">         order by observationMJD</span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">candidateID</span><span class="p">))</span>

      <span class="n">resultSet</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span> <span class="p">()</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>

   <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">resultSet</span> <span class="o">=</span> <span class="p">()</span>

   <span class="k">return</span> <span class="n">resultSet</span>

</div>
<div class="viewcode-block" id="getUserAddedSummaryRows"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.getUserAddedSummaryRows">[docs]</a><span class="k">def</span> <span class="nf">getUserAddedSummaryRows</span><span class="p">(</span><span class="n">dbConn</span><span class="p">):</span>

   <span class="k">try</span><span class="p">:</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbConn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>

      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span> <span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">         select *</span>
<span class="s">         from fs_user_added</span>
<span class="s">         where (summaryRow is true</span>
<span class="s">                and (ingested is true</span>
<span class="s">                and candidateID in (select distinct candidateID</span>
<span class="s">                                    from fs_user_added</span>
<span class="s">                                    where ingested is false)))</span>
<span class="s">         or (summaryRow is true</span>
<span class="s">             and ingested is false)</span>
<span class="s">         order by discDate</span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">)</span>

      <span class="n">resultSet</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span> <span class="p">()</span>
      <span class="n">cursor</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>

   <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">resultSet</span> <span class="o">=</span> <span class="p">()</span>

   <span class="k">return</span> <span class="n">resultSet</span>

</div>
<div class="viewcode-block" id="updateLSQIngestStatus"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.updateLSQIngestStatus">[docs]</a><span class="k">def</span> <span class="nf">updateLSQIngestStatus</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">rowId</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>

   <span class="n">rowsUpdated</span> <span class="o">=</span> <span class="mi">0</span>

   <span class="k">try</span><span class="p">:</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbConn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>

      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span> <span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">          update fs_lsq</span>
<span class="s">          set ingested = </span><span class="si">%s</span><span class="s"></span>
<span class="s">          where id = </span><span class="si">%s</span><span class="s"></span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">rowId</span><span class="p">))</span>

      <span class="n">rowsUpdated</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span>

      <span class="c"># Did we update any transient object rows? If not issue a warning.</span>
      <span class="k">if</span> <span class="n">rowsUpdated</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
         <span class="k">print</span> <span class="s">&quot;WARNING: No transient object entries were updated.&quot;</span>

      <span class="n">cursor</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>


   <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

   <span class="k">return</span> <span class="n">rowsUpdated</span>

</div>
<div class="viewcode-block" id="updatePanstarrsIngestStatus"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.updatePanstarrsIngestStatus">[docs]</a><span class="k">def</span> <span class="nf">updatePanstarrsIngestStatus</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">rowId</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>

   <span class="n">rowsUpdated</span> <span class="o">=</span> <span class="mi">0</span>

   <span class="k">try</span><span class="p">:</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbConn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>

      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span> <span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">          update fs_panstarrs</span>
<span class="s">          set ingested = </span><span class="si">%s</span><span class="s"></span>
<span class="s">          where id = </span><span class="si">%s</span><span class="s"></span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">rowId</span><span class="p">))</span>

      <span class="n">rowsUpdated</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span>

      <span class="c"># Did we update any transient object rows? If not issue a warning.</span>
      <span class="k">if</span> <span class="n">rowsUpdated</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
         <span class="k">print</span> <span class="s">&quot;WARNING: No transient object entries were updated.&quot;</span>

      <span class="n">cursor</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>


   <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

   <span class="k">return</span> <span class="n">rowsUpdated</span>

</div>
<div class="viewcode-block" id="updateChaseIngestStatus"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.updateChaseIngestStatus">[docs]</a><span class="k">def</span> <span class="nf">updateChaseIngestStatus</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">rowId</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>

   <span class="n">rowsUpdated</span> <span class="o">=</span> <span class="mi">0</span>

   <span class="k">try</span><span class="p">:</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbConn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>

      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span> <span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">          update fs_chase</span>
<span class="s">          set ingested = </span><span class="si">%s</span><span class="s"></span>
<span class="s">          where id = </span><span class="si">%s</span><span class="s"></span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">rowId</span><span class="p">))</span>

      <span class="n">rowsUpdated</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span>

      <span class="c"># Did we update any transient object rows? If not issue a warning.</span>
      <span class="k">if</span> <span class="n">rowsUpdated</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
         <span class="k">print</span> <span class="s">&quot;WARNING: No transient object entries were updated.&quot;</span>

      <span class="n">cursor</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>


   <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

   <span class="k">return</span> <span class="n">rowsUpdated</span>


</div>
<div class="viewcode-block" id="updateUserAddedIngestStatus"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.updateUserAddedIngestStatus">[docs]</a><span class="k">def</span> <span class="nf">updateUserAddedIngestStatus</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">rowId</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>

   <span class="n">rowsUpdated</span> <span class="o">=</span> <span class="mi">0</span>

   <span class="k">try</span><span class="p">:</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbConn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>

      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span> <span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">          update fs_user_added</span>
<span class="s">          set ingested = </span><span class="si">%s</span><span class="s"></span>
<span class="s">          where id = </span><span class="si">%s</span><span class="s"></span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="n">rowId</span><span class="p">))</span>

      <span class="n">rowsUpdated</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span>

      <span class="c"># Did we update any transient object rows? If not issue a warning.</span>
      <span class="k">if</span> <span class="n">rowsUpdated</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
         <span class="k">print</span> <span class="s">&quot;WARNING: No transient object entries were updated.&quot;</span>

      <span class="n">cursor</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>


   <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

   <span class="k">return</span> <span class="n">rowsUpdated</span>




</div>
<div class="viewcode-block" id="insertTransientBucket"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.insertTransientBucket">[docs]</a><span class="k">def</span> <span class="nf">insertTransientBucket</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span>
                          <span class="n">transientBucketId</span><span class="p">,</span>
                          <span class="n">masterIDFlag</span><span class="p">,</span>
                          <span class="n">name</span><span class="p">,</span>
                          <span class="n">survey</span><span class="p">,</span>
                          <span class="n">observationDate</span><span class="p">,</span>
                          <span class="n">observationMJD</span><span class="p">,</span>
                          <span class="n">raDeg</span><span class="p">,</span>
                          <span class="n">decDeg</span><span class="p">,</span>
                          <span class="n">raDegErr</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">decDegErr</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">magnitude</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">magnitudeError</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="nb">filter</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">transientRedshift</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">transientRedshiftNotes</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">lastNonDetectionMJD</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">lastNonDetectionDate</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">spectralType</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">discoveryPhase</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">dateCreated</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">dateLastModified</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">surveyObjectUrl</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">transientTypePrediction</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">transientTypePredicationSource</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">hostRedshift</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">hostRedshiftType</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">referenceImageUrl</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">targetImageUrl</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">subtractedImageUrl</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">tripletImageUrl</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">htm20ID</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">htm16ID</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">cx</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">cy</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                          <span class="n">cz</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>

   <span class="k">try</span><span class="p">:</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbConn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>

      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span> <span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">             insert into transientBucket (</span>
<span class="s">                                 transientBucketId,</span>
<span class="s">                                 masterIDFlag,</span>
<span class="s">                                 name,</span>
<span class="s">                                 survey,</span>
<span class="s">                                 raDeg,</span>
<span class="s">                                 decDeg,</span>
<span class="s">                                 raDegErr,</span>
<span class="s">                                 decDegErr,</span>
<span class="s">                                 observationDate,</span>
<span class="s">                                 observationMJD,</span>
<span class="s">                                 magnitude,</span>
<span class="s">                                 magnitudeError,</span>
<span class="s">                                 filter,</span>
<span class="s">                                 transientRedshift,</span>
<span class="s">                                 transientRedshiftNotes,</span>
<span class="s">                                 lastNonDetectionMJD,</span>
<span class="s">                                 lastNonDetectionDate,</span>
<span class="s">                                 spectralType,</span>
<span class="s">                                 discoveryPhase,</span>
<span class="s">                                 dateCreated,</span>
<span class="s">                                 dateLastModified,</span>
<span class="s">                                 surveyObjectUrl,</span>
<span class="s">                                 transientTypePrediction,</span>
<span class="s">                                 transientTypePredicationSource,</span>
<span class="s">                                 hostRedshift,</span>
<span class="s">                                 hostRedshiftType,</span>
<span class="s">                                 referenceImageUrl,</span>
<span class="s">                                 targetImageUrl,</span>
<span class="s">                                 subtractedImageUrl,</span>
<span class="s">                                 tripletImageUrl,</span>
<span class="s">                                 htm20ID,</span>
<span class="s">                                 htm16ID,</span>
<span class="s">                                 cx,</span>
<span class="s">                                 cy,</span>
<span class="s">                                 cz</span>
<span class="s">                                 )</span>
<span class="s">             values (</span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">, </span><span class="si">%s</span><span class="s">)</span>
<span class="s">          &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span>
                                 <span class="n">transientBucketId</span><span class="p">,</span>
                                 <span class="n">masterIDFlag</span><span class="p">,</span>
                                 <span class="n">name</span><span class="p">,</span>
                                 <span class="n">survey</span><span class="p">,</span>
                                 <span class="n">raDeg</span><span class="p">,</span>
                                 <span class="n">decDeg</span><span class="p">,</span>
                                 <span class="n">raDegErr</span><span class="p">,</span>
                                 <span class="n">decDegErr</span><span class="p">,</span>
                                 <span class="n">observationDate</span><span class="p">,</span>
                                 <span class="n">observationMJD</span><span class="p">,</span>
                                 <span class="n">magnitude</span><span class="p">,</span>
                                 <span class="n">magnitudeError</span><span class="p">,</span>
                                 <span class="nb">filter</span><span class="p">,</span>
                                 <span class="n">transientRedshift</span><span class="p">,</span>
                                 <span class="n">transientRedshiftNotes</span><span class="p">,</span>
                                 <span class="n">lastNonDetectionMJD</span><span class="p">,</span>
                                 <span class="n">lastNonDetectionDate</span><span class="p">,</span>
                                 <span class="n">spectralType</span><span class="p">,</span>
                                 <span class="n">discoveryPhase</span><span class="p">,</span>
                                 <span class="n">dateCreated</span><span class="p">,</span>
                                 <span class="n">dateLastModified</span><span class="p">,</span>
                                 <span class="n">surveyObjectUrl</span><span class="p">,</span>
                                 <span class="n">transientTypePrediction</span><span class="p">,</span>
                                 <span class="n">transientTypePredicationSource</span><span class="p">,</span>
                                 <span class="n">hostRedshift</span><span class="p">,</span>
                                 <span class="n">hostRedshiftType</span><span class="p">,</span>
                                 <span class="n">referenceImageUrl</span><span class="p">,</span>
                                 <span class="n">targetImageUrl</span><span class="p">,</span>
                                 <span class="n">subtractedImageUrl</span><span class="p">,</span>
                                 <span class="n">tripletImageUrl</span><span class="p">,</span>
                                 <span class="n">htm20ID</span><span class="p">,</span>
                                 <span class="n">htm16ID</span><span class="p">,</span>
                                 <span class="n">cx</span><span class="p">,</span>
                                 <span class="n">cy</span><span class="p">,</span>
                                 <span class="n">cz</span>
                 <span class="p">))</span>

      <span class="n">cursor</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>

   <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1062</span><span class="p">:</span> <span class="c"># Duplicate Key error</span>
         <span class="k">print</span> <span class="n">e</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="k">print</span> <span class="n">e</span>

   <span class="n">cursor</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>
   <span class="k">return</span> <span class="n">dbConn</span><span class="o">.</span><span class="n">insert_id</span><span class="p">()</span>




<span class="c"># When the master object is inserted, we don&#39;t know the primaryKeyId, so we can&#39;t</span>
<span class="c"># set the transientBucketId equal to the primaryKeyId. We have to do it later.</span>
</div>
<div class="viewcode-block" id="updateTransientBucketMasterIdForMaster"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.updateTransientBucketMasterIdForMaster">[docs]</a><span class="k">def</span> <span class="nf">updateTransientBucketMasterIdForMaster</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">primaryKeyId</span><span class="p">):</span>
   <span class="n">rowsUpdated</span> <span class="o">=</span> <span class="mi">0</span>

   <span class="k">try</span><span class="p">:</span>
      <span class="n">cursor</span> <span class="o">=</span> <span class="n">dbConn</span><span class="o">.</span><span class="n">cursor</span><span class="p">(</span><span class="n">MySQLdb</span><span class="o">.</span><span class="n">cursors</span><span class="o">.</span><span class="n">DictCursor</span><span class="p">)</span>

      <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span> <span class="p">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">          update transientBucket</span>
<span class="s">          set transientBucketId = </span><span class="si">%s</span><span class="s"></span>
<span class="s">          where primaryKeyId = </span><span class="si">%s</span><span class="s"></span>
<span class="s">          and masterIDFlag is true</span>
<span class="s">      &quot;&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">primaryKeyId</span><span class="p">,</span> <span class="n">primaryKeyId</span><span class="p">))</span>

      <span class="n">rowsUpdated</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span>

      <span class="c"># Did we update any transient object rows? If not issue a warning.</span>
      <span class="k">if</span> <span class="n">rowsUpdated</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
         <span class="k">print</span> <span class="s">&quot;WARNING: No transient object entries were updated.&quot;</span>

      <span class="n">cursor</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>


   <span class="k">except</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">Error</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&quot;Error </span><span class="si">%d</span><span class="s">: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">e</span><span class="o">.</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

   <span class="k">return</span> <span class="n">rowsUpdated</span>





</div>
<div class="viewcode-block" id="ingestLSQData"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.ingestLSQData">[docs]</a><span class="k">def</span> <span class="nf">ingestLSQData</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">):</span>

   <span class="n">currentDate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&quot;</span><span class="p">)</span>
   <span class="n">summaryRows</span> <span class="o">=</span> <span class="n">getLSQSummaryRows</span><span class="p">(</span><span class="n">dbConn</span><span class="p">)</span>

   <span class="c"># We only need to match the &quot;master&quot; objects</span>
   <span class="n">tableName</span> <span class="o">=</span> <span class="s">&#39;view_transientBucketMaster&#39;</span>

   <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">summaryRows</span><span class="p">:</span>

      <span class="c"># Get the recurrences</span>

      <span class="n">recurrenceRows</span> <span class="o">=</span> <span class="n">getLSQRecurrenceRows</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;candidateID&quot;</span><span class="p">])</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="n">recurrenceRows</span><span class="p">:</span>
         <span class="c"># Skip this row - we don&#39;t have any recurrences (shouldn&#39;t happen)</span>
         <span class="k">print</span> <span class="s">&quot;No recurrence data!&quot;</span>
         <span class="k">continue</span>

      <span class="c"># We will crossmatch using the AVERAGE RA and DEC, but will only add the recurrence rows to the transientBucket.</span>
      <span class="c"># The recurrence rows will NOT be crossmatched.</span>

      <span class="c"># Note that we should ONLY be crossmatching against the MASTER objects.  Time for a new view!</span>
      <span class="n">ra</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;ra_deg&quot;</span><span class="p">]</span>
      <span class="n">dec</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;dec_deg&quot;</span><span class="p">]</span>
      <span class="k">print</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;candidateID&quot;</span><span class="p">],</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;mag&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;discDate&quot;</span><span class="p">]</span>
      <span class="n">message</span><span class="p">,</span> <span class="n">transientBucketXMObjects</span> <span class="o">=</span> <span class="n">coneSearch</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">tableName</span><span class="p">,</span> <span class="n">queryType</span> <span class="o">=</span> <span class="n">FULL</span><span class="p">,</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">dbConn</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">message</span> <span class="ow">and</span> <span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;Error&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;not recognised&#39;</span> <span class="ow">in</span> <span class="n">message</span><span class="p">):</span>
         <span class="c"># Successful cone searches should not return an error message, otherwise something went wrong.</span>
         <span class="k">print</span> <span class="s">&quot;Database error - cone search unsuccessful.  Message was:&quot;</span>
         <span class="k">print</span> <span class="s">&quot;</span><span class="se">\t</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">message</span>
         <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

      <span class="n">transientBucketId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
      <span class="n">masterIDFlag</span> <span class="o">=</span> <span class="bp">True</span>

      <span class="k">if</span> <span class="n">transientBucketXMObjects</span><span class="p">:</span>
         <span class="c"># We have a match - and we only want the nearest row.</span>
         <span class="n">masterIDFlag</span> <span class="o">=</span> <span class="bp">False</span>

         <span class="n">numberOfMatches</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">transientBucketXMObjects</span><span class="p">)</span>
         <span class="n">nearestSep</span> <span class="o">=</span> <span class="n">transientBucketXMObjects</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
         <span class="n">nearestCatRow</span> <span class="o">=</span> <span class="n">transientBucketXMObjects</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
         <span class="n">nearestCatId</span> <span class="o">=</span> <span class="n">nearestCatRow</span><span class="p">[</span><span class="n">CAT_ID_RA_DEC_COLS</span><span class="p">[</span><span class="n">tableName</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

         <span class="n">transientBucketId</span> <span class="o">=</span> <span class="n">nearestCatRow</span><span class="p">[</span><span class="s">&quot;transientBucketId&quot;</span><span class="p">]</span>
         <span class="k">print</span> <span class="n">transientBucketId</span><span class="p">,</span> <span class="n">masterIDFlag</span>

      <span class="c"># 2012-08-16 KWS Added spectralType</span>
      <span class="k">for</span> <span class="n">recRow</span> <span class="ow">in</span> <span class="n">recurrenceRows</span><span class="p">:</span>
         <span class="n">primaryKeyId</span> <span class="o">=</span> <span class="n">insertTransientBucket</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span>
                                    <span class="n">transientBucketId</span><span class="p">,</span>
                                    <span class="n">masterIDFlag</span><span class="p">,</span>
                                    <span class="n">row</span><span class="p">[</span><span class="s">&quot;candidateID&quot;</span><span class="p">],</span>
                                    <span class="n">SURVEYS</span><span class="o">.</span><span class="n">LSQ</span><span class="p">,</span>
                                    <span class="n">getDateFromMJD</span><span class="p">(</span><span class="n">recRow</span><span class="p">[</span><span class="s">&quot;observationJD&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">2400000.5</span><span class="p">),</span>
                                    <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;observationJD&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mf">2400000.5</span><span class="p">,</span>
                                    <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;ra_deg&quot;</span><span class="p">],</span>
                                    <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;dec_deg&quot;</span><span class="p">],</span>
                                    <span class="n">magnitude</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;mag&quot;</span><span class="p">],</span>
                                    <span class="n">magnitudeError</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;magErr&quot;</span><span class="p">],</span>
                                    <span class="n">dateCreated</span> <span class="o">=</span> <span class="n">currentDate</span><span class="p">,</span>
                                    <span class="n">dateLastModified</span> <span class="o">=</span> <span class="n">currentDate</span><span class="p">,</span>
                                    <span class="n">surveyObjectUrl</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;historyURL&quot;</span><span class="p">],</span>
                                    <span class="n">transientTypePrediction</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;suggestedType&quot;</span><span class="p">],</span>
                                    <span class="n">hostRedshift</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;hostZ&quot;</span><span class="p">],</span>
                                    <span class="n">tripletImageUrl</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;tripletImageURL&quot;</span><span class="p">],</span>
                                    <span class="n">spectralType</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;specType&quot;</span><span class="p">],</span>
                                    <span class="n">htm20ID</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;htm20ID&quot;</span><span class="p">],</span>
                                    <span class="n">htm16ID</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;htm16ID&quot;</span><span class="p">],</span>
                                    <span class="n">cx</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;cx&quot;</span><span class="p">],</span>
                                    <span class="n">cy</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;cy&quot;</span><span class="p">],</span>
                                    <span class="n">cz</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;cz&quot;</span><span class="p">],</span>
                                    <span class="n">transientRedshift</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;transientZ&quot;</span><span class="p">],</span>
                                    <span class="n">lastNonDetectionDate</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;lastNonDetection&quot;</span><span class="p">])</span>


         <span class="n">updateLSQIngestStatus</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">])</span>

         <span class="k">if</span> <span class="n">masterIDFlag</span> <span class="ow">and</span> <span class="n">primaryKeyId</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">masterIDFlag</span><span class="p">,</span> <span class="n">primaryKeyId</span>
            <span class="n">updateTransientBucketMasterIdForMaster</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">primaryKeyId</span><span class="p">)</span>
            <span class="n">transientBucketId</span> <span class="o">=</span> <span class="n">primaryKeyId</span>
            <span class="n">masterIDFlag</span> <span class="o">=</span> <span class="bp">False</span>


      <span class="k">if</span> <span class="n">primaryKeyId</span><span class="p">:</span>
         <span class="c"># The row definitely got added to the transientBucket</span>
         <span class="n">updateLSQIngestStatus</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">])</span>

   <span class="k">return</span> <span class="mi">0</span>


</div>
<div class="viewcode-block" id="ingestPanstarrsData"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.ingestPanstarrsData">[docs]</a><span class="k">def</span> <span class="nf">ingestPanstarrsData</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">):</span>

   <span class="n">currentDate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&quot;</span><span class="p">)</span>
   <span class="n">summaryRows</span> <span class="o">=</span> <span class="n">getPanstarrsSummaryRows</span><span class="p">(</span><span class="n">dbConn</span><span class="p">)</span>

   <span class="c"># We only need to match the &quot;master&quot; objects</span>
   <span class="n">tableName</span> <span class="o">=</span> <span class="s">&#39;view_transientBucketMaster&#39;</span>

   <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">summaryRows</span><span class="p">:</span>

      <span class="c"># Get the recurrences</span>

      <span class="n">recurrenceRows</span> <span class="o">=</span> <span class="n">getPanstarrsRecurrenceRows</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;candidateID&quot;</span><span class="p">])</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="n">recurrenceRows</span><span class="p">:</span>
         <span class="c"># Skip this row - we don&#39;t have any recurrences (shouldn&#39;t happen)</span>
         <span class="k">print</span> <span class="s">&quot;No recurrence data!&quot;</span>
         <span class="k">continue</span>

      <span class="c"># We will crossmatch using the AVERAGE RA and DEC, but will only add the recurrence rows to the transientBucket.</span>
      <span class="c"># The recurrence rows will NOT be crossmatched.</span>

      <span class="c"># Note that we should ONLY be crossmatching against the MASTER objects.  Time for a new view!</span>
      <span class="n">ra</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;ra_deg&quot;</span><span class="p">]</span>
      <span class="n">dec</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;dec_deg&quot;</span><span class="p">]</span>
      <span class="k">print</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;candidateID&quot;</span><span class="p">],</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;mag&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;discDate&quot;</span><span class="p">]</span>
      <span class="n">message</span><span class="p">,</span> <span class="n">transientBucketXMObjects</span> <span class="o">=</span> <span class="n">coneSearch</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">tableName</span><span class="p">,</span> <span class="n">queryType</span> <span class="o">=</span> <span class="n">FULL</span><span class="p">,</span> <span class="n">dbConn</span> <span class="o">=</span> <span class="n">dbConn</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">message</span> <span class="ow">and</span> <span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;Error&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;not recognised&#39;</span> <span class="ow">in</span> <span class="n">message</span><span class="p">):</span>
         <span class="c"># Successful cone searches should not return an error message, otherwise something went wrong.</span>
         <span class="k">print</span> <span class="s">&quot;Database error - cone search unsuccessful.  Message was:&quot;</span>
         <span class="k">print</span> <span class="s">&quot;</span><span class="se">\t</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">message</span>
         <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

      <span class="n">transientBucketId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
      <span class="n">masterIDFlag</span> <span class="o">=</span> <span class="bp">True</span>

      <span class="k">if</span> <span class="n">transientBucketXMObjects</span><span class="p">:</span>
         <span class="c"># We have a match - and we only want the nearest row.</span>
         <span class="n">masterIDFlag</span> <span class="o">=</span> <span class="bp">False</span>

         <span class="n">numberOfMatches</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">transientBucketXMObjects</span><span class="p">)</span>
         <span class="n">nearestSep</span> <span class="o">=</span> <span class="n">transientBucketXMObjects</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
         <span class="n">nearestCatRow</span> <span class="o">=</span> <span class="n">transientBucketXMObjects</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
         <span class="n">nearestCatId</span> <span class="o">=</span> <span class="n">nearestCatRow</span><span class="p">[</span><span class="n">CAT_ID_RA_DEC_COLS</span><span class="p">[</span><span class="n">tableName</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

         <span class="n">transientBucketId</span> <span class="o">=</span> <span class="n">nearestCatRow</span><span class="p">[</span><span class="s">&quot;transientBucketId&quot;</span><span class="p">]</span>
         <span class="k">print</span> <span class="n">transientBucketId</span><span class="p">,</span> <span class="n">masterIDFlag</span>

      <span class="k">for</span> <span class="n">recRow</span> <span class="ow">in</span> <span class="n">recurrenceRows</span><span class="p">:</span>
         <span class="n">primaryKeyId</span> <span class="o">=</span> <span class="n">insertTransientBucket</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span>
                                    <span class="n">transientBucketId</span><span class="p">,</span>
                                    <span class="n">masterIDFlag</span><span class="p">,</span>
                                    <span class="n">row</span><span class="p">[</span><span class="s">&quot;candidateID&quot;</span><span class="p">],</span>
                                    <span class="n">SURVEYS</span><span class="o">.</span><span class="n">PS1</span><span class="p">,</span>
                                    <span class="n">getDateFromMJD</span><span class="p">(</span><span class="n">recRow</span><span class="p">[</span><span class="s">&quot;observationMJD&quot;</span><span class="p">]),</span>
                                    <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;observationMJD&quot;</span><span class="p">],</span>
                                    <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;ra_deg&quot;</span><span class="p">],</span>
                                    <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;dec_deg&quot;</span><span class="p">],</span>
                                    <span class="n">magnitude</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;mag&quot;</span><span class="p">],</span>
                                    <span class="n">magnitudeError</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;magErr&quot;</span><span class="p">],</span>
                                    <span class="nb">filter</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;filter&quot;</span><span class="p">],</span>
                                    <span class="n">dateCreated</span> <span class="o">=</span> <span class="n">currentDate</span><span class="p">,</span>
                                    <span class="n">dateLastModified</span> <span class="o">=</span> <span class="n">currentDate</span><span class="p">,</span>
                                    <span class="n">surveyObjectUrl</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;objectURL&quot;</span><span class="p">],</span>
                                    <span class="n">transientTypePrediction</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;suggestedType&quot;</span><span class="p">],</span>
                                    <span class="n">hostRedshift</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;hostZ&quot;</span><span class="p">],</span>
                                    <span class="n">targetImageUrl</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;targetImageURL&quot;</span><span class="p">],</span>
                                    <span class="n">htm20ID</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;htm20ID&quot;</span><span class="p">],</span>
                                    <span class="n">htm16ID</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;htm16ID&quot;</span><span class="p">],</span>
                                    <span class="n">cx</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;cx&quot;</span><span class="p">],</span>
                                    <span class="n">cy</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;cy&quot;</span><span class="p">],</span>
                                    <span class="n">cz</span> <span class="o">=</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;cz&quot;</span><span class="p">])</span>

         <span class="n">updatePanstarrsIngestStatus</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">recRow</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">])</span>

         <span class="k">if</span> <span class="n">masterIDFlag</span> <span class="ow">and</span> <span class="n">primaryKeyId</span><span class="p">:</span>
            <span class="k">print</span> <span class="n">masterIDFlag</span><span class="p">,</span> <span class="n">primaryKeyId</span>
            <span class="n">updateTransientBucketMasterIdForMaster</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">primaryKeyId</span><span class="p">)</span>
            <span class="n">transientBucketId</span> <span class="o">=</span> <span class="n">primaryKeyId</span>
            <span class="n">masterIDFlag</span> <span class="o">=</span> <span class="bp">False</span>


      <span class="k">if</span> <span class="n">primaryKeyId</span><span class="p">:</span>
         <span class="c"># The row definitely got added to the transientBucket</span>
         <span class="n">updatePanstarrsIngestStatus</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">])</span>

   <span class="k">return</span> <span class="mi">0</span>

</div>
<div class="viewcode-block" id="ingestChaseData"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.ingestChaseData">[docs]</a><span class="k">def</span> <span class="nf">ingestChaseData</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">):</span>

   <span class="c"># The CHASE data currently doesn&#39;t show any recurrences.  All the data</span>
   <span class="c"># are summary rows only.  This is currently real data from fake CSVs,</span>
   <span class="c"># but once this gets published automatically, this code will be revisited.</span>

   <span class="n">currentDate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&quot;</span><span class="p">)</span>
   <span class="n">summaryRows</span> <span class="o">=</span> <span class="n">getChaseSummaryRows</span><span class="p">(</span><span class="n">dbConn</span><span class="p">)</span>

   <span class="c"># We only need to match the &quot;master&quot; objects</span>
   <span class="n">tableName</span> <span class="o">=</span> <span class="s">&#39;view_transientBucketMaster&#39;</span>

   <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">summaryRows</span><span class="p">:</span>

      <span class="c"># Get the recurrences</span>

      <span class="c"># There are no CHASE recurrence rows yet. This code will be uncommented when this starts to happen.</span>
      <span class="c">#recurrenceRows = getChaseRecurrenceRows(dbConn, row[&quot;candidateID&quot;])</span>

      <span class="c">#if not recurrenceRows:</span>
      <span class="c">#   # Skip this row - we don&#39;t have any recurrences (shouldn&#39;t happen)</span>
      <span class="c">#   print &quot;No recurrence data!&quot;</span>
      <span class="c">#   continue</span>

      <span class="c"># We will crossmatch using the AVERAGE RA and DEC, but will only add the recurrence rows to the transientBucket.</span>
      <span class="c"># The recurrence rows will NOT be crossmatched.</span>

      <span class="c"># Note that we should ONLY be crossmatching against the MASTER objects.  Time for a new view!</span>
      <span class="n">ra</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;ra_deg&quot;</span><span class="p">]</span>
      <span class="n">dec</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;dec_deg&quot;</span><span class="p">]</span>
      <span class="k">print</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;candidateID&quot;</span><span class="p">],</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;mag&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;discDate&quot;</span><span class="p">]</span>
      <span class="n">message</span><span class="p">,</span> <span class="n">transientBucketXMObjects</span> <span class="o">=</span> <span class="n">coneSearch</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">tableName</span><span class="p">,</span> <span class="n">queryType</span> <span class="o">=</span> <span class="n">FULL</span><span class="p">,</span> <span class="n">dbConn</span> <span class="o">=</span> <span class="n">dbConn</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">message</span> <span class="ow">and</span> <span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;Error&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;not recognised&#39;</span> <span class="ow">in</span> <span class="n">message</span><span class="p">):</span>
         <span class="c"># Successful cone searches should not return an error message, otherwise something went wrong.</span>
         <span class="k">print</span> <span class="s">&quot;Database error - cone search unsuccessful.  Message was:&quot;</span>
         <span class="k">print</span> <span class="s">&quot;</span><span class="se">\t</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">message</span>
         <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

      <span class="n">transientBucketId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
      <span class="n">masterIDFlag</span> <span class="o">=</span> <span class="bp">True</span>

      <span class="k">if</span> <span class="n">transientBucketXMObjects</span><span class="p">:</span>
         <span class="c"># We have a match - and we only want the nearest row.</span>
         <span class="n">masterIDFlag</span> <span class="o">=</span> <span class="bp">False</span>

         <span class="n">numberOfMatches</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">transientBucketXMObjects</span><span class="p">)</span>
         <span class="n">nearestSep</span> <span class="o">=</span> <span class="n">transientBucketXMObjects</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
         <span class="n">nearestCatRow</span> <span class="o">=</span> <span class="n">transientBucketXMObjects</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
         <span class="n">nearestCatId</span> <span class="o">=</span> <span class="n">nearestCatRow</span><span class="p">[</span><span class="n">CAT_ID_RA_DEC_COLS</span><span class="p">[</span><span class="n">tableName</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

         <span class="n">transientBucketId</span> <span class="o">=</span> <span class="n">nearestCatRow</span><span class="p">[</span><span class="s">&quot;transientBucketId&quot;</span><span class="p">]</span>
         <span class="k">print</span> <span class="n">transientBucketId</span><span class="p">,</span> <span class="n">masterIDFlag</span>

      <span class="c">#for recRow in recurrenceRows:</span>
      <span class="n">primaryKeyId</span> <span class="o">=</span> <span class="n">insertTransientBucket</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span>
                                    <span class="n">transientBucketId</span><span class="p">,</span>
                                    <span class="n">masterIDFlag</span><span class="p">,</span>
                                    <span class="n">row</span><span class="p">[</span><span class="s">&quot;candidateID&quot;</span><span class="p">],</span>
                                    <span class="n">SURVEYS</span><span class="o">.</span><span class="n">CHASE</span><span class="p">,</span>
                                    <span class="n">getDateFromMJD</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&quot;observationMJD&quot;</span><span class="p">]),</span>
                                    <span class="n">row</span><span class="p">[</span><span class="s">&quot;observationMJD&quot;</span><span class="p">],</span>
                                    <span class="n">row</span><span class="p">[</span><span class="s">&quot;ra_deg&quot;</span><span class="p">],</span>
                                    <span class="n">row</span><span class="p">[</span><span class="s">&quot;dec_deg&quot;</span><span class="p">],</span>
                                    <span class="n">magnitude</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;mag&quot;</span><span class="p">],</span>
                                    <span class="n">magnitudeError</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;magErr&quot;</span><span class="p">],</span>
                                    <span class="n">dateCreated</span> <span class="o">=</span> <span class="n">currentDate</span><span class="p">,</span>
                                    <span class="n">dateLastModified</span> <span class="o">=</span> <span class="n">currentDate</span><span class="p">,</span>
                                    <span class="n">surveyObjectUrl</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;objectURL&quot;</span><span class="p">],</span>
                                    <span class="n">transientTypePrediction</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;suggestedType&quot;</span><span class="p">],</span>
                                    <span class="n">hostRedshift</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;hostZ&quot;</span><span class="p">],</span>
                                    <span class="n">tripletImageUrl</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;tripletImageURL&quot;</span><span class="p">],</span>
                                    <span class="n">htm20ID</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;htm20ID&quot;</span><span class="p">],</span>
                                    <span class="n">htm16ID</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;htm16ID&quot;</span><span class="p">],</span>
                                    <span class="n">cx</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;cx&quot;</span><span class="p">],</span>
                                    <span class="n">cy</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;cy&quot;</span><span class="p">],</span>
                                    <span class="n">cz</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;cz&quot;</span><span class="p">])</span>


      <span class="k">if</span> <span class="n">masterIDFlag</span> <span class="ow">and</span> <span class="n">primaryKeyId</span><span class="p">:</span>
         <span class="k">print</span> <span class="n">masterIDFlag</span><span class="p">,</span> <span class="n">primaryKeyId</span>
         <span class="n">updateTransientBucketMasterIdForMaster</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">primaryKeyId</span><span class="p">)</span>
         <span class="n">transientBucketId</span> <span class="o">=</span> <span class="n">primaryKeyId</span>
         <span class="n">masterIDFlag</span> <span class="o">=</span> <span class="bp">False</span>


      <span class="k">if</span> <span class="n">primaryKeyId</span><span class="p">:</span>
         <span class="c"># The row definitely got added to the transientBucket</span>
         <span class="n">updateChaseIngestStatus</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">])</span>

   <span class="k">return</span> <span class="mi">0</span>

</div>
<div class="viewcode-block" id="ingestUserAddedData"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.ingestUserAddedData">[docs]</a><span class="k">def</span> <span class="nf">ingestUserAddedData</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">):</span>

   <span class="c"># The CHASE data currently doesn&#39;t show any recurrences.  All the data</span>
   <span class="c"># are summary rows only.  This is currently real data from fake CSVs,</span>
   <span class="c"># but once this gets published automatically, this code will be revisited.</span>

   <span class="n">currentDate</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&quot;%Y-%m-</span><span class="si">%d</span><span class="s"> %H:%M:%S&quot;</span><span class="p">)</span>
   <span class="n">summaryRows</span> <span class="o">=</span> <span class="n">getUserAddedSummaryRows</span><span class="p">(</span><span class="n">dbConn</span><span class="p">)</span>

   <span class="c"># We only need to match the &quot;master&quot; objects</span>
   <span class="n">tableName</span> <span class="o">=</span> <span class="s">&#39;view_transientBucketMaster&#39;</span>

   <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">summaryRows</span><span class="p">:</span>

      <span class="c"># Get the recurrences</span>

      <span class="c"># There are no user added recurrence rows yet. This code will be uncommented when this starts to happen.</span>
      <span class="c">#recurrenceRows = getUserAddedRecurrenceRows(dbConn, row[&quot;candidateID&quot;])</span>

      <span class="c">#if not recurrenceRows:</span>
      <span class="c">#   # Skip this row - we don&#39;t have any recurrences (shouldn&#39;t happen)</span>
      <span class="c">#   print &quot;No recurrence data!&quot;</span>
      <span class="c">#   continue</span>

      <span class="c"># We will crossmatch using the AVERAGE RA and DEC, but will only add the recurrence rows to the transientBucket.</span>
      <span class="c"># The recurrence rows will NOT be crossmatched.</span>

      <span class="c"># Note that we should ONLY be crossmatching against the MASTER objects.  Time for a new view!</span>
      <span class="n">ra</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;ra_deg&quot;</span><span class="p">]</span>
      <span class="n">dec</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;dec_deg&quot;</span><span class="p">]</span>
      <span class="k">print</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;candidateID&quot;</span><span class="p">],</span> <span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;mag&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;discDate&quot;</span><span class="p">]</span>


      <span class="c"># These are &quot;user added&quot; rows, so are the HTM and cartesian values populated?</span>

      <span class="n">s_htm16ID</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;htm16ID&quot;</span><span class="p">]</span>
      <span class="n">s_htm20ID</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;htm20ID&quot;</span><span class="p">]</span>
      <span class="n">s_cx</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;cx&quot;</span><span class="p">]</span>
      <span class="n">s_cy</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;cy&quot;</span><span class="p">]</span>
      <span class="n">s_cz</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;cz&quot;</span><span class="p">]</span>

      <span class="k">if</span> <span class="ow">not</span> <span class="n">s_htm16ID</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">s_htm20ID</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">s_cx</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">s_cy</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">s_cz</span><span class="p">:</span>
         <span class="c"># If ANY one of the value is not set, recalculate</span>
         <span class="k">print</span> <span class="s">&quot;Calculating HTM IDs and cartesians...&quot;</span>
         <span class="n">s_htm16ID</span> <span class="o">=</span> <span class="n">htmID</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">htmLevel</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
         <span class="n">s_htm20ID</span> <span class="o">=</span> <span class="n">htmID</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">htmLevel</span> <span class="o">=</span> <span class="mi">20</span><span class="p">)</span>
         <span class="n">s_cx</span><span class="p">,</span> <span class="n">s_cy</span><span class="p">,</span> <span class="n">s_cz</span> <span class="o">=</span> <span class="n">calculate_cartesians</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">)</span>


      <span class="n">message</span><span class="p">,</span> <span class="n">transientBucketXMObjects</span> <span class="o">=</span> <span class="n">coneSearch</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">tableName</span><span class="p">,</span> <span class="n">queryType</span> <span class="o">=</span> <span class="n">FULL</span><span class="p">,</span> <span class="n">dbConn</span> <span class="o">=</span> <span class="n">dbConn</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">message</span> <span class="ow">and</span> <span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;Error&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;not recognised&#39;</span> <span class="ow">in</span> <span class="n">message</span><span class="p">):</span>
         <span class="c"># Successful cone searches should not return an error message, otherwise something went wrong.</span>
         <span class="k">print</span> <span class="s">&quot;Database error - cone search unsuccessful.  Message was:&quot;</span>
         <span class="k">print</span> <span class="s">&quot;</span><span class="se">\t</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">message</span>
         <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

      <span class="n">transientBucketId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
      <span class="n">masterIDFlag</span> <span class="o">=</span> <span class="bp">True</span>

      <span class="k">if</span> <span class="n">transientBucketXMObjects</span><span class="p">:</span>

         <span class="c"># We have a match - and we only want the nearest row.</span>
         <span class="n">masterIDFlag</span> <span class="o">=</span> <span class="bp">False</span>

         <span class="n">numberOfMatches</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">transientBucketXMObjects</span><span class="p">)</span>
         <span class="n">nearestSep</span> <span class="o">=</span> <span class="n">transientBucketXMObjects</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
         <span class="n">nearestCatRow</span> <span class="o">=</span> <span class="n">transientBucketXMObjects</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
         <span class="n">nearestCatId</span> <span class="o">=</span> <span class="n">nearestCatRow</span><span class="p">[</span><span class="n">CAT_ID_RA_DEC_COLS</span><span class="p">[</span><span class="n">tableName</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

         <span class="n">transientBucketId</span> <span class="o">=</span> <span class="n">nearestCatRow</span><span class="p">[</span><span class="s">&quot;transientBucketId&quot;</span><span class="p">]</span>
         <span class="k">print</span> <span class="s">&#39;Object exists: &#39;</span><span class="p">,</span> <span class="n">transientBucketId</span><span class="p">,</span> <span class="n">nearestCatRow</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">]</span>

      <span class="c">#continue</span>

      <span class="c">#for recRow in recurrenceRows:</span>

      <span class="c"># 2012-08-31 KWS Added new data from the fs_user_added table into the transientBucket</span>
      <span class="n">primaryKeyId</span> <span class="o">=</span> <span class="n">insertTransientBucket</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span>
                                    <span class="n">transientBucketId</span><span class="p">,</span>
                                    <span class="n">masterIDFlag</span><span class="p">,</span>
                                    <span class="n">row</span><span class="p">[</span><span class="s">&quot;candidateID&quot;</span><span class="p">],</span>
                                    <span class="n">row</span><span class="p">[</span><span class="s">&quot;survey&quot;</span><span class="p">],</span>
                                    <span class="n">getDateFromMJD</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&quot;observationMJD&quot;</span><span class="p">]),</span>
                                    <span class="n">row</span><span class="p">[</span><span class="s">&quot;observationMJD&quot;</span><span class="p">],</span>
                                    <span class="n">row</span><span class="p">[</span><span class="s">&quot;ra_deg&quot;</span><span class="p">],</span>
                                    <span class="n">row</span><span class="p">[</span><span class="s">&quot;dec_deg&quot;</span><span class="p">],</span>
                                    <span class="n">magnitude</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;mag&quot;</span><span class="p">],</span>
                                    <span class="n">magnitudeError</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;magErr&quot;</span><span class="p">],</span>
                                    <span class="n">dateCreated</span> <span class="o">=</span> <span class="n">currentDate</span><span class="p">,</span>
                                    <span class="n">dateLastModified</span> <span class="o">=</span> <span class="n">currentDate</span><span class="p">,</span>
                                    <span class="n">surveyObjectUrl</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;objectURL&quot;</span><span class="p">],</span>
                                    <span class="n">transientTypePrediction</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;suggestedType&quot;</span><span class="p">],</span>
                                    <span class="n">hostRedshift</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;hostZ&quot;</span><span class="p">],</span>
                                    <span class="n">targetImageUrl</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;targetImageURL&quot;</span><span class="p">],</span>
                                    <span class="n">spectralType</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;suggestedClassification&quot;</span><span class="p">],</span>
                                    <span class="n">htm20ID</span> <span class="o">=</span> <span class="n">s_htm20ID</span><span class="p">,</span>
                                    <span class="n">htm16ID</span> <span class="o">=</span> <span class="n">s_htm16ID</span><span class="p">,</span>
                                    <span class="n">cx</span> <span class="o">=</span> <span class="n">s_cx</span><span class="p">,</span>
                                    <span class="n">cy</span> <span class="o">=</span> <span class="n">s_cy</span><span class="p">,</span>
                                    <span class="n">cz</span> <span class="o">=</span> <span class="n">s_cz</span><span class="p">)</span>


      <span class="k">if</span> <span class="n">masterIDFlag</span> <span class="ow">and</span> <span class="n">primaryKeyId</span><span class="p">:</span>
         <span class="k">print</span> <span class="n">masterIDFlag</span><span class="p">,</span> <span class="n">primaryKeyId</span>
         <span class="n">updateTransientBucketMasterIdForMaster</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">primaryKeyId</span><span class="p">)</span>
         <span class="n">transientBucketId</span> <span class="o">=</span> <span class="n">primaryKeyId</span>
         <span class="n">masterIDFlag</span> <span class="o">=</span> <span class="bp">False</span>

      <span class="k">if</span> <span class="n">primaryKeyId</span><span class="p">:</span>
         <span class="c"># The row definitely got added to the transientBucket</span>
         <span class="n">updateUserAddedIngestStatus</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s">&quot;id&quot;</span><span class="p">])</span>

   <span class="k">return</span> <span class="mi">0</span>





<span class="c"># Modify this code to read the data from the LSQ ingest table.</span>
<span class="c"># Read the summary rows first (in order of discovery date), then for each</span>
<span class="c"># row read the recurrences in ascending date order.</span>
<span class="c"># Crossmatch each summary row to find any other items.</span>

</div>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../bucketFiller.html#bucketFiller.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">argv</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  <span class="kn">import</span> <span class="nn">pesstoMarshallCommonUtils</span> <span class="kn">as</span> <span class="nn">p</span>

  <span class="c">## DAVE ADDED THIS YAML DICTIONARY DBCONN &amp; LOGGING ON DECEMBER 7, 2012</span>
  <span class="c">## SETUP DB CONNECTION AND A LOGGER</span>
  <span class="n">dbConn</span><span class="p">,</span> <span class="n">log</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span>
  <span class="c">## START LOGGING ##</span>
  <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;----- STARTING TO RUN THE bucketFiller -----&#39;</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">argv</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;HO&quot;</span>
    <span class="c"># argv = sys.argv</span>
  <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">argv</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">database</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">hostname</span> <span class="o">=</span> <span class="n">argv</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="c">#conn = dbConnect(hostname, username, password, database)</span>

  <span class="c"># if len(argv) != 5:</span>
  <span class="c">#  sys.exit(&quot;Usage: bucketFiller.py &lt;username&gt; &lt;password&gt; &lt;database&gt; &lt;hostname&gt;&quot;)</span>

  <span class="n">returnCode</span> <span class="o">=</span> <span class="n">ingestLSQData</span><span class="p">(</span><span class="n">dbConn</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">returnCode</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Did not run LSQ ingester.&quot;</span>

  <span class="n">returnCode</span> <span class="o">=</span> <span class="n">ingestPanstarrsData</span><span class="p">(</span><span class="n">dbConn</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">returnCode</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Did not run PanSTARRS ingester.&quot;</span>

  <span class="n">returnCode</span> <span class="o">=</span> <span class="n">ingestChaseData</span><span class="p">(</span><span class="n">dbConn</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">returnCode</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Did not run CHASE ingester.&quot;</span>

  <span class="n">returnCode</span> <span class="o">=</span> <span class="n">ingestUserAddedData</span><span class="p">(</span><span class="n">dbConn</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">returnCode</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">&quot;Did not run UserAdded ingester.&quot;</span>



  <span class="n">dbConn</span><span class="o">.</span><span class="n">commit</span> <span class="p">()</span>
  <span class="n">dbConn</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>
  <span class="c">## FINISH LOGGING ##</span>
  <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;----- FINISHED ATTEMPT TO RUN THE bucketFiller -----&#39;</span><span class="p">)</span>
  <span class="k">return</span> <span class="mi">0</span>



</div>
<span class="k">if</span> <span class="n">__name__</span><span class="o">==</span><span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>

          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      Last updated on Mar 28, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>