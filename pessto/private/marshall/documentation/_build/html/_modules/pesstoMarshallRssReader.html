

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>pesstoMarshallRssReader &mdash; PESSTO Marshall 0.6.5 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.6.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="PESSTO Marshall 0.6.5 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 10px 10px 15px 15px">
<a href="../index.html">Dave Young's Python Documentation</a>
</div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>

          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>

      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/pessto_icon.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for pesstoMarshallRssReader</h1><div class="highlight"><pre>
<span class="c">#!/usr/local/bin/python</span>
<span class="c"># encoding: utf-8</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">pesstoMarshallRssReader</span>

<span class="sd">This is the PESSTO Marshall RSS Reader - subscribe to feeds here (comment out once subscribed). This script should be run every few minutes to collect more data from the various rss feed sources.</span>

<span class="sd">Created by David Young on November 2, 2012</span>
<span class="sd">If you have any questions requiring this script please email me: d.r.young@qub.ac.uk</span>

<span class="sd">dryx syntax:</span>
<span class="sd">xxx = come back here and do some more work</span>

<span class="sd">notes:</span>
<span class="sd">    - Dave started work on this code on November 2, 2012</span>
<span class="sd">    - Dave &#39;completed&#39; this code on November 8, 2012</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c">############################################</span>
<span class="c"># MAIN LOOP                                #</span>
<span class="c">############################################</span>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../pesstoMarshallRssReader.html#pesstoMarshallRssReader.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="c">################ &gt; IMPORTS ################</span>
    <span class="kn">import</span> <span class="nn">pesstoMarshallCommonUtils</span> <span class="kn">as</span> <span class="nn">p</span>
    <span class="kn">import</span> <span class="nn">dryxMySQL</span> <span class="kn">as</span> <span class="nn">m</span>
    <span class="kn">import</span> <span class="nn">dryxXMLTools</span> <span class="kn">as</span> <span class="nn">x</span>
    <span class="kn">import</span> <span class="nn">utils</span> <span class="kn">as</span> <span class="nn">u</span>
    <span class="kn">import</span> <span class="nn">re</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">dryxWebCrawlers</span> <span class="kn">as</span> <span class="nn">wc</span>

    <span class="c">################ &gt; SETUP ##################</span>
    <span class="c">## SETUP DB dbConnECTION AND A LOGGER</span>
    <span class="n">dbConn</span><span class="p">,</span> <span class="n">log</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">settings</span><span class="p">()</span>
    <span class="c">## START LOGGING ##</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;----- STARTING TO READ THE PESSTO FEEDERS RSS FEEDS -----&#39;</span><span class="p">)</span>

    <span class="c">## INSTANSIATE THE PESSTO FEEDER SURVEY *RSS* READER (pfr) ##</span>
    <span class="n">pfrr</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rss_reader</span><span class="p">()</span>
    <span class="n">pfrr</span><span class="o">.</span><span class="n">dbConn</span> <span class="o">=</span> <span class="n">dbConn</span>
    <span class="n">pfrr</span><span class="o">.</span><span class="n">subscriptionTable</span> <span class="o">=</span> <span class="s">&quot;rss_subscriptions&quot;</span>

    <span class="c">## CRTS FEEDS - 3 TELESCOPES WRAPPED UNDER ONE NAME</span>
    <span class="c">## THESE ARE VARIOUS RECEIPIES CREATED WITH SKYALERTS - http://skyalert.org/rules/</span>
    <span class="c">##########################################################################################################</span>
    <span class="n">subc</span> <span class="o">=</span> <span class="n">pfrr</span><span class="o">.</span><span class="n">set_subscription</span>
    <span class="n">subc</span><span class="p">(</span><span class="s">&#39;http://skyalert.org/feeds/686&#39;</span><span class="p">,</span><span class="s">&#39;crts&#39;</span><span class="p">,</span><span class="s">&#39;css ng&#39;</span><span class="p">,[</span><span class="s">&#39;updated&#39;</span><span class="p">,</span><span class="s">&#39;voevent_ra&#39;</span><span class="p">])</span>
    <span class="n">subc</span><span class="p">(</span><span class="s">&#39;http://skyalert.org/feeds/689&#39;</span><span class="p">,</span><span class="s">&#39;crts&#39;</span><span class="p">,</span><span class="s">&#39;css p60&#39;</span><span class="p">,[</span><span class="s">&#39;updated&#39;</span><span class="p">,</span><span class="s">&#39;voevent_ra&#39;</span><span class="p">])</span>
    <span class="n">subc</span><span class="p">(</span><span class="s">&#39;http://skyalert.org/feeds/667&#39;</span><span class="p">,</span><span class="s">&#39;crts&#39;</span><span class="p">,</span><span class="s">&#39;css wc&#39;</span><span class="p">,[</span><span class="s">&#39;updated&#39;</span><span class="p">,</span><span class="s">&#39;voevent_ra&#39;</span><span class="p">])</span>
    <span class="n">subc</span><span class="p">(</span><span class="s">&#39;http://skyalert.org/feeds/687&#39;</span><span class="p">,</span><span class="s">&#39;crts&#39;</span><span class="p">,</span><span class="s">&#39;mls ng&#39;</span><span class="p">,[</span><span class="s">&#39;updated&#39;</span><span class="p">,</span><span class="s">&#39;voevent_ra&#39;</span><span class="p">])</span>
    <span class="n">subc</span><span class="p">(</span><span class="s">&#39;http://skyalert.org/feeds/690&#39;</span><span class="p">,</span><span class="s">&#39;crts&#39;</span><span class="p">,</span><span class="s">&#39;mls p60&#39;</span><span class="p">,[</span><span class="s">&#39;updated&#39;</span><span class="p">,</span><span class="s">&#39;voevent_ra&#39;</span><span class="p">])</span>
    <span class="n">subc</span><span class="p">(</span><span class="s">&#39;http://skyalert.org/feeds/664&#39;</span><span class="p">,</span><span class="s">&#39;crts&#39;</span><span class="p">,</span><span class="s">&#39;mls wc&#39;</span><span class="p">,[</span><span class="s">&#39;updated&#39;</span><span class="p">,</span><span class="s">&#39;voevent_ra&#39;</span><span class="p">])</span>
    <span class="n">subc</span><span class="p">(</span><span class="s">&#39;http://skyalert.org/feeds/665&#39;</span><span class="p">,</span><span class="s">&#39;crts&#39;</span><span class="p">,</span><span class="s">&#39;sss wc&#39;</span><span class="p">,[</span><span class="s">&#39;updated&#39;</span><span class="p">,</span><span class="s">&#39;voevent_ra&#39;</span><span class="p">])</span>
    <span class="n">subc</span><span class="p">(</span><span class="s">&#39;http://skyalert.org/feeds/688&#39;</span><span class="p">,</span><span class="s">&#39;crts&#39;</span><span class="p">,</span><span class="s">&#39;sss ng&#39;</span><span class="p">,[</span><span class="s">&#39;updated&#39;</span><span class="p">,</span><span class="s">&#39;voevent_ra&#39;</span><span class="p">])</span>
    <span class="n">subc</span><span class="p">(</span><span class="s">&#39;http://skyalert.org/feeds/691&#39;</span><span class="p">,</span><span class="s">&#39;crts&#39;</span><span class="p">,</span><span class="s">&#39;sss p60&#39;</span><span class="p">,[</span><span class="s">&#39;updated&#39;</span><span class="p">,</span><span class="s">&#39;voevent_ra&#39;</span><span class="p">])</span>
    <span class="c"># A FEW OTHER CRTS FEEDS WE COULD SUBSCRIBE TO</span>
    <span class="c">#subc(&#39;http://skyalert.org/feeds/151&#39;,&#39;crts_css_agn&#39;,&#39;crts_css&#39;,[&#39;updated&#39;,&#39;ra&#39;])</span>
    <span class="c">#subc(&#39;http://skyalert.org/feeds/142&#39;,&#39;crts_css_bright&#39;,&#39;crts_css&#39;,[&#39;updated&#39;,&#39;ra&#39;])</span>
    <span class="c">#subc(&#39;http://skyalert.org/feeds/149&#39;,&#39;crts_mls_bright&#39;,&#39;crts_mls&#39;,[&#39;updated&#39;,&#39;ra&#39;])</span>

    <span class="c">## REFRESH ALL THE FEEDS IN THE SUBSCRIPTION TABLE</span>
    <span class="n">pfrr</span><span class="o">.</span><span class="n">refresh_rss_feeds</span><span class="p">()</span>

    <span class="c">## SET THE NAMES OF THE RSS FEEDS (feedName COLUMN) THAT DELIVER VOEVENT FEEDS</span>
    <span class="n">voEventRssFeeds</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;crts&#39;</span><span class="p">]</span>

    <span class="c"># ADD HTMIDS AND SUMMARY &amp; INGEST FLAGS TO NEW ROWS</span>
    <span class="n">sqlQuery</span> <span class="o">=</span> <span class="s">&quot;SELECT rssFeedName from &quot;</span><span class="o">+</span><span class="n">pfrr</span><span class="o">.</span><span class="n">subscriptionTable</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_read_query</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="n">add_htm_ids_to_rss_feed_tables</span><span class="p">(</span><span class="s">&#39;voevent_ra&#39;</span><span class="p">,</span><span class="s">&#39;voevent_dec&#39;</span><span class="p">,</span><span class="s">&#39;rss_channel_&#39;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;rssFeedName&#39;</span><span class="p">],</span><span class="n">dbConn</span><span class="p">)</span>
        <span class="n">add_ingested_and_summary_columns_to_tables</span><span class="p">(</span><span class="s">&#39;rss_channel_&#39;</span><span class="o">+</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;rssFeedName&#39;</span><span class="p">],</span><span class="n">dbConn</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;----- FINISHED READING THE XML SUBSCRIPTIONS -----&#39;</span><span class="p">)</span>


    <span class="c"># INSTANSIATE THE PESSTO OBJECT *VOEVENT* READER (povr)</span>
    <span class="n">povr</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rss_reader</span><span class="p">()</span>
    <span class="n">povr</span><span class="o">.</span><span class="n">dbConn</span> <span class="o">=</span> <span class="n">dbConn</span>
    <span class="n">povr</span><span class="o">.</span><span class="n">subscriptionTable</span> <span class="o">=</span> <span class="s">&quot;voevent_subscriptions&quot;</span>
    <span class="n">povr</span><span class="o">.</span><span class="n">_feedTablePrefix</span> <span class="o">=</span> <span class="s">&quot;voevent_streams_&quot;</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;----- STARTING TO READ THE PESSTO OBJECT VOEVENT FEEDS -----&#39;</span><span class="p">)</span>

    <span class="c"># LIFT VOEVENT URLS FROM RELEVENT SURVEYS AND ADD THEM TO voevent_stream_subscriptions TABLE</span>
    <span class="k">for</span> <span class="n">vrf</span> <span class="ow">in</span> <span class="n">voEventRssFeeds</span><span class="p">:</span>
      <span class="n">rssChannelTable</span> <span class="o">=</span> <span class="s">&#39;rss_channel_&#39;</span><span class="o">+</span><span class="n">vrf</span>
      <span class="n">sqlQuery</span> <span class="o">=</span> <span class="s">&#39;select primaryId, rssFeedSource, rssFeedName, links from &#39;</span><span class="o">+</span><span class="n">rssChannelTable</span><span class="o">+</span><span class="s">&#39; where awaitingAction = 1&#39;</span>
      <span class="n">rows</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_read_query</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>

      <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
        <span class="c"># EXTRACT VOEVENT URL</span>
        <span class="n">voEventUrl</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;ht.{7,40}xml\/[0-9]{5,7}&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;links&#39;</span><span class="p">]))</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c"># EXTRACT VOEVENT NUMBER</span>
        <span class="n">skyalertNum</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s">&#39;[0-9]{5,7}&#39;</span><span class="p">,</span><span class="n">voEventUrl</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="c"># ADD SUBSCRIPTION</span>
        <span class="n">povr</span><span class="o">.</span><span class="n">set_subscription</span><span class="p">(</span><span class="n">voEventUrl</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;rssFeedName&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;rssFeedSource&#39;</span><span class="p">],[</span><span class="s">&#39;ivorn&#39;</span><span class="p">])</span>
        <span class="c"># SET THE awaitingAction FLAG TO FALSE</span>
        <span class="n">m</span><span class="o">.</span><span class="n">set_flag</span><span class="p">(</span><span class="n">dbConn</span><span class="p">,</span><span class="n">rssChannelTable</span><span class="p">,</span><span class="s">&#39;awaitingAction&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="s">&#39;primaryId&#39;</span><span class="p">,</span> <span class="n">row</span><span class="p">[</span><span class="s">&#39;primaryId&#39;</span><span class="p">])</span>

    <span class="c"># REFRESH ALL OF THE VOEVENT FEEDS SUBSCRIBED TO SO FAR</span>
    <span class="n">povr</span><span class="o">.</span><span class="n">refresh_voevent_feeds</span><span class="p">()</span>

    <span class="c"># ADD A FEW OTHER COLUMNS FOR CRTS OBJECTS</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add_column_to_db_table</span><span class="p">(</span><span class="s">&#39;rss_channel_crts&#39;</span><span class="p">,</span><span class="s">&#39;crtsId&#39;</span><span class="p">,</span><span class="s">&#39;BIGINT&#39;</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add_column_to_db_table</span><span class="p">(</span><span class="s">&#39;rss_channel_crts&#39;</span><span class="p">,</span><span class="s">&#39;circularUrl&#39;</span><span class="p">,</span><span class="s">&#39;varchar(200)&#39;</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add_column_to_db_table</span><span class="p">(</span><span class="s">&#39;rss_channel_crts&#39;</span><span class="p">,</span><span class="s">&#39;circularDate&#39;</span><span class="p">,</span><span class="s">&#39;varchar(200)&#39;</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add_column_to_db_table</span><span class="p">(</span><span class="s">&#39;rss_channel_crts&#39;</span><span class="p">,</span><span class="s">&#39;circularComment&#39;</span><span class="p">,</span><span class="s">&#39;varchar(200)&#39;</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add_column_to_db_table</span><span class="p">(</span><span class="s">&#39;rss_channel_crts&#39;</span><span class="p">,</span><span class="s">&#39;objectType&#39;</span><span class="p">,</span><span class="s">&#39;varchar(200)&#39;</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>

    <span class="c">## EXTRACT OUT THE CRTS ID AND CREATE THE CIRCULAR URL</span>
    <span class="n">reCrtsId</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\d{16,22}$&#39;</span><span class="p">)</span>
    <span class="n">sqlQuery</span> <span class="o">=</span> <span class="s">&quot;select primaryId, id from rss_channel_crts where crtsId is NULL or circularUrl is NULL&quot;</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;attempting to read crts ids from the rss_channel_crts table&quot;</span><span class="p">)</span>
      <span class="n">rows</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_read_query</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s">&quot;could not read crts ids from the rss_channel_crts table - failed with this error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),))</span>
      <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
      <span class="n">crtsId</span> <span class="o">=</span> <span class="n">reCrtsId</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">group</span><span class="p">()</span>
      <span class="n">sqlQuery</span> <span class="o">=</span> <span class="s">&quot;UPDATE rss_channel_crts SET crtsId = &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">crtsId</span><span class="p">)</span><span class="o">+</span><span class="s">&quot; WHERE primaryId = &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&quot;primaryId&quot;</span><span class="p">])</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;attempting to add the crtsIds to the rss_channel_crts table&quot;</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_write_query</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;could not add the crtsIds to the rss_channel_crts table - failed with this error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),))</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

      <span class="n">circularUrl</span> <span class="o">=</span> <span class="s">&quot;http://nesssi.cacr.caltech.edu/catalina/Circulars/&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">crtsId</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;.html&quot;</span>
      <span class="n">sqlQuery</span> <span class="o">=</span> <span class="s">&quot;UPDATE rss_channel_crts SET circularUrl = &#39;&quot;</span><span class="o">+</span><span class="n">circularUrl</span><span class="o">+</span><span class="s">&quot;&#39; WHERE primaryId = &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s">&quot;primaryId&quot;</span><span class="p">])</span>
      <span class="k">try</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;attempting to add the crts ciruclar urls to the rss_channel_crts table&quot;</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_write_query</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;could not add the crtsIds to the rss_channel_crts table - failed with this error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),))</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c">## DOWNLOAD THE CRTS CIRCULAR FILES</span>
    <span class="n">sqlQuery</span> <span class="o">=</span> <span class="s">&quot;select * from rss_channel_crts where objectType is NULL&quot;</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&quot;attempting to select the crts objects with no ciruclars yet&quot;</span><span class="p">)</span>
      <span class="n">rows</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_read_query</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
      <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;could not select the crts objects with no ciruclars yet - failed with this error </span><span class="si">%s</span><span class="s">: &quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),))</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">circularUrls</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
      <span class="n">circularUrls</span> <span class="o">+=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s">&quot;circularUrl&quot;</span><span class="p">]]</span>

    <span class="n">downloadDirectory</span> <span class="o">=</span> <span class="s">&quot;/tmp&quot;</span>
    <span class="n">localUrls</span> <span class="o">=</span> <span class="n">wc</span><span class="o">.</span><span class="n">multiWebDocumentDownloader</span><span class="p">(</span><span class="n">circularUrls</span><span class="p">,</span><span class="n">downloadDirectory</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">reCrtsId</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;&lt;td&gt;\s*?&lt;b&gt;\s*?ID:\s*?&lt;\/b&gt;\s*?(\d{12,22})\s*?&lt;\/td&gt;&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
    <span class="n">reUtTime</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;&lt;td&gt;\s*?&lt;b&gt;\s*?UT Time:\s*?&lt;\/b&gt;\s*?(\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2})\s*?&lt;\/td&gt;&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
    <span class="n">reDetails</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;&lt;td&gt;\s*?&lt;b&gt;Details:\s*?&lt;\/b&gt;\s*?(.*?)&lt;\/td&gt;&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
    <span class="n">reClass</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;(\.([^\..]*?))$&#39;</span><span class="p">,</span><span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">url</span> <span class="ow">in</span> <span class="n">localUrls</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">url</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">rf</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="s">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">+</span><span class="n">url</span>
        <span class="k">print</span> <span class="n">text</span>
        <span class="n">crtsId</span> <span class="o">=</span> <span class="n">reCrtsId</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">utTime</span> <span class="o">=</span> <span class="n">reUtTime</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">details</span> <span class="o">=</span> <span class="n">reDetails</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
          <span class="n">cclass</span> <span class="o">=</span> <span class="n">reClass</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">details</span><span class="p">)</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
          <span class="c">#cclass = &quot;NO GO!&quot;</span>
          <span class="n">cclass</span> <span class="o">=</span> <span class="n">details</span>
        <span class="k">print</span> <span class="n">crtsId</span><span class="p">,</span> <span class="n">utTime</span><span class="p">,</span> <span class="n">details</span><span class="p">,</span> <span class="n">cclass</span>

        <span class="n">sqlQuery</span> <span class="o">=</span> <span class="s">&quot;UPDATE rss_channel_crts SET circularDate = &#39;</span><span class="si">%s</span><span class="s">&#39;, objectType = &#39;</span><span class="si">%s</span><span class="s">&#39;, circularComment = &#39;</span><span class="si">%s</span><span class="s">&#39; where crtsId = </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">utTime</span><span class="p">,</span><span class="n">cclass</span><span class="p">,</span><span class="n">details</span><span class="p">,</span><span class="n">crtsId</span><span class="p">)</span>
        <span class="k">print</span> <span class="n">sqlQuery</span>
        <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_write_query</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>

        <span class="n">rf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">dbConn</span><span class="o">.</span><span class="n">commit</span> <span class="p">()</span>
    <span class="n">dbConn</span><span class="o">.</span><span class="n">close</span> <span class="p">()</span>
    <span class="c">## FINISH LOGGING ##</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;----- FINISHED ATTEMPT TO READ THE PESSTO OBJECT VOEVENT FEEDS -----&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="bp">None</span>


<span class="c">########################################################################</span>
<span class="c">#  Function to calculate HTMId info give an ra and dec(WRTITEN BY DRYX)  #</span>
<span class="c">########################################################################</span>
<span class="c">## LAST MODIFIED : 20121102</span>
<span class="c">## CREATED : 20121102</span></div>
<div class="viewcode-block" id="add_htm_ids_to_rss_feed_tables"><a class="viewcode-back" href="../pesstoMarshallRssReader.html#pesstoMarshallRssReader.add_htm_ids_to_rss_feed_tables">[docs]</a><span class="k">def</span> <span class="nf">add_htm_ids_to_rss_feed_tables</span><span class="p">(</span><span class="n">raColName</span><span class="p">,</span><span class="n">declColName</span><span class="p">,</span><span class="n">tableName</span><span class="p">,</span><span class="n">dbConn</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Function to calculate HTMId info give an ra and dec</span>

<span class="sd">      Key Arguments:</span>
<span class="sd">        - ra -- ra in sexegesimal</span>
<span class="sd">        - decl -- dec in sexegesimal</span>
<span class="sd">        - tableName -- name of table to add htmid info to</span>
<span class="sd">        - dbConn -- database hosting the above table</span>

<span class="sd">      Returns</span>
<span class="sd">        - None</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c">## &gt; IMPORTS ##</span>
  <span class="kn">import</span> <span class="nn">logging</span> <span class="kn">as</span> <span class="nn">l</span>
  <span class="kn">import</span> <span class="nn">utils</span> <span class="kn">as</span> <span class="nn">u</span>
  <span class="kn">import</span> <span class="nn">dryxMySQL</span> <span class="kn">as</span> <span class="nn">m</span>

  <span class="c">## &gt;SETTINGS ##</span>

  <span class="c">###########################################################</span>
  <span class="c"># &gt;ACTION(S)                                              #</span>
  <span class="c">###########################################################</span>
  <span class="n">htmCols</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;htm16ID&#39;</span><span class="p">:</span><span class="s">&#39;BIGINT(20)&#39;</span><span class="p">,</span><span class="s">&#39;htm20ID&#39;</span><span class="p">:</span><span class="s">&#39;BIGINT(20)&#39;</span><span class="p">,</span><span class="s">&#39;cx&#39;</span><span class="p">:</span><span class="s">&#39;DOUBLE&#39;</span><span class="p">,</span><span class="s">&#39;cy&#39;</span><span class="p">:</span><span class="s">&#39;DOUBLE&#39;</span><span class="p">,</span><span class="s">&#39;cz&#39;</span><span class="p">:</span><span class="s">&#39;DOUBLE&#39;</span><span class="p">}</span>

  <span class="c"># CHECK IF COLUMN EXISTS YET - IF NOT CREATE IT</span>
  <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">htmCols</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">colExists</span> <span class="o">=</span> <span class="s">&quot;SELECT *</span><span class="se">\</span>
<span class="s">                FROM information_schema.COLUMNS</span><span class="se">\</span>
<span class="s">                WHERE TABLE_SCHEMA=DATABASE()</span><span class="se">\</span>
<span class="s">                  AND COLUMN_NAME=&#39;&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s">&quot;&#39;</span><span class="se">\</span>
<span class="s">                  AND TABLE_NAME=&#39;&quot;</span><span class="o">+</span><span class="n">tableName</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span>
    <span class="n">colExists</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_read_query</span><span class="p">(</span><span class="n">colExists</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">colExists</span><span class="p">:</span>
        <span class="n">sqlQuery</span> <span class="o">=</span> <span class="s">&quot;ALTER TABLE &quot;</span><span class="o">+</span><span class="n">tableName</span><span class="o">+</span><span class="s">&quot; ADD &quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">htmCols</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; DEFAULT NULL&quot;</span>
        <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_write_query</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>


  <span class="n">sqlQuery</span> <span class="o">=</span> <span class="s">&quot;SELECT primaryId, &quot;</span><span class="o">+</span><span class="n">raColName</span><span class="o">+</span><span class="s">&quot;, &quot;</span><span class="o">+</span><span class="n">declColName</span><span class="o">+</span><span class="s">&quot; from &quot;</span><span class="o">+</span><span class="n">tableName</span><span class="o">+</span><span class="s">&quot; where htm16ID is NULL&quot;</span>
  <span class="n">rows</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_read_query</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>

  <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="n">thisRa</span><span class="p">,</span> <span class="n">thisDec</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">raColName</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="n">declColName</span><span class="p">])</span>
    <span class="n">htm16ID</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">htmID</span><span class="p">(</span><span class="n">thisRa</span><span class="p">,</span> <span class="n">thisDec</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
    <span class="n">htm20ID</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">htmID</span><span class="p">(</span><span class="n">thisRa</span><span class="p">,</span> <span class="n">thisDec</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

    <span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span> <span class="n">cz</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">calculate_cartesians</span><span class="p">(</span><span class="n">thisRa</span><span class="p">,</span> <span class="n">thisDec</span><span class="p">)</span>

    <span class="n">sqlQuery</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;UPDATE </span><span class="si">%s</span><span class="s"> SET htm16ID=</span><span class="si">%s</span><span class="s">, htm20ID=</span><span class="si">%s</span><span class="s">,cx=</span><span class="si">%s</span><span class="s">,cy=</span><span class="si">%s</span><span class="s">,cz=</span><span class="si">%s</span><span class="s"></span>
<span class="s">                        where primaryId = &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tableName</span><span class="p">,</span><span class="n">htm16ID</span><span class="p">,</span><span class="n">htm20ID</span><span class="p">,</span><span class="n">cx</span><span class="p">,</span><span class="n">cy</span><span class="p">,</span><span class="n">cz</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;primaryId&#39;</span><span class="p">])</span>

    <span class="n">l</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s">&#39;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#39;</span><span class="p">)</span>

    <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_write_query</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>

    <span class="n">sqlQuery</span> <span class="o">=</span> <span class="s">&quot;SELECT primaryId, &quot;</span><span class="o">+</span><span class="n">raColName</span><span class="o">+</span><span class="s">&quot;, &quot;</span><span class="o">+</span><span class="n">declColName</span><span class="o">+</span><span class="s">&quot; from &quot;</span><span class="o">+</span><span class="n">tableName</span><span class="o">+</span><span class="s">&quot; where htm16ID is NULL&quot;</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_read_query</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>

  <span class="c">#try:</span>
  <span class="c">#  something</span>
  <span class="c">#except Exception, e:</span>
   <span class="c"># logging.error(&quot;something went wrong&quot;+str(e)+&quot;\n&quot;)</span>

  <span class="k">return</span> <span class="bp">None</span>

</div>
<div class="viewcode-block" id="add_ingested_and_summary_columns_to_tables"><a class="viewcode-back" href="../pesstoMarshallRssReader.html#pesstoMarshallRssReader.add_ingested_and_summary_columns_to_tables">[docs]</a><span class="k">def</span> <span class="nf">add_ingested_and_summary_columns_to_tables</span><span class="p">(</span><span class="n">tableName</span><span class="p">,</span><span class="n">dbConn</span><span class="p">,</span><span class="n">summaryDefault</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Function to add &#39;ingested&#39; and &#39;summary&#39; flag columns to mysql db table</span>

<span class="sd">      Key Arguments:</span>
<span class="sd">        - tableName -- name of table to columns to</span>
<span class="sd">        - dbConn -- database hosting the above table</span>

<span class="sd">      Returns</span>
<span class="sd">        - None</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="c">## &gt; IMPORTS ##</span>
  <span class="kn">import</span> <span class="nn">logging</span> <span class="kn">as</span> <span class="nn">l</span>
  <span class="kn">import</span> <span class="nn">dryxMySQL</span> <span class="kn">as</span> <span class="nn">m</span>

  <span class="c">## &gt;SETTINGS ##</span>

  <span class="c">###########################################################</span>
  <span class="c"># &gt;ACTION(S)                                              #</span>
  <span class="c">###########################################################</span>
  <span class="n">colsToAdd</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;summaryRow&#39;</span><span class="p">:</span><span class="s">&#39;TINYINT&#39;</span><span class="p">,</span><span class="s">&#39;ingested&#39;</span><span class="p">:</span><span class="s">&#39;TINYINT&#39;</span><span class="p">}</span>

  <span class="c"># CHECK IF COLUMN EXISTS YET - IF NOT CREATE IT</span>
  <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">colsToAdd</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">colExists</span> <span class="o">=</span> <span class="s">&quot;SELECT *</span><span class="se">\</span>
<span class="s">                FROM information_schema.COLUMNS</span><span class="se">\</span>
<span class="s">                WHERE TABLE_SCHEMA=DATABASE()</span><span class="se">\</span>
<span class="s">                  AND COLUMN_NAME=&#39;&quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s">&quot;&#39;</span><span class="se">\</span>
<span class="s">                  AND TABLE_NAME=&#39;&quot;</span><span class="o">+</span><span class="n">tableName</span><span class="o">+</span><span class="s">&quot;&#39;&quot;</span>
    <span class="n">colExists</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_read_query</span><span class="p">(</span><span class="n">colExists</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">colExists</span><span class="p">:</span>
        <span class="n">sqlQuery</span> <span class="o">=</span> <span class="s">&quot;ALTER TABLE &quot;</span><span class="o">+</span><span class="n">tableName</span><span class="o">+</span><span class="s">&quot; ADD &quot;</span><span class="o">+</span><span class="n">key</span><span class="o">+</span><span class="s">&quot; &quot;</span><span class="o">+</span><span class="n">colsToAdd</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; DEFAULT NULL&quot;</span>
        <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_write_query</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>


  <span class="n">sqlQuery</span> <span class="o">=</span> <span class="s">&quot;SELECT primaryId from &quot;</span><span class="o">+</span><span class="n">tableName</span><span class="o">+</span><span class="s">&quot; where summaryRow is NULL&quot;</span>
  <span class="n">rows</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_read_query</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>

  <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="n">sqlQuery</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;UPDATE </span><span class="si">%s</span><span class="s"> SET summaryRow=</span><span class="si">%s</span><span class="s"></span>
<span class="s">                        where primaryId = &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tableName</span><span class="p">,</span><span class="n">summaryDefault</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;primaryId&#39;</span><span class="p">])</span>
    <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_write_query</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>

  <span class="n">sqlQuery</span> <span class="o">=</span> <span class="s">&quot;SELECT primaryId from &quot;</span><span class="o">+</span><span class="n">tableName</span><span class="o">+</span><span class="s">&quot; where ingested is NULL&quot;</span>
  <span class="n">rows</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_read_query</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>

  <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
    <span class="n">sqlQuery</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;UPDATE </span><span class="si">%s</span><span class="s"> SET ingested=0</span>
<span class="s">                        where primaryId = &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tableName</span><span class="p">,</span><span class="n">row</span><span class="p">[</span><span class="s">&#39;primaryId&#39;</span><span class="p">])</span>
    <span class="n">m</span><span class="o">.</span><span class="n">execute_mysql_write_query</span><span class="p">(</span><span class="n">sqlQuery</span><span class="p">,</span><span class="n">dbConn</span><span class="p">)</span>


  <span class="k">return</span> <span class="bp">None</span>




</div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
  <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">home</a>|&nbsp;</li>
        <li><a href="../search.html">search</a>|&nbsp;</li>

          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      Last updated on Mar 28, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>