/*
 * websupport.js
 * ~~~~~~~~~~~~~
 *
 * sphinx.websupport utilties for all documentation.
 *
 * :copyright: Copyright 2007-2011 by the Sphinx team, see AUTHORS.
 * :license: BSD, see LICENSE for details.
 *
 */(function(e){e.fn.autogrow=function(){return this.each(function(){var t=this;e.fn.autogrow.resize(t);e(t).focus(function(){t.interval=setInterval(function(){e.fn.autogrow.resize(t)},500)}).blur(function(){clearInterval(t.interval)})})};e.fn.autogrow.resize=function(t){var n=parseInt(e(t).css("line-height"),10),r=t.value.split("\n"),i=t.cols,s=0;e.each(r,function(){s+=Math.ceil(this.length/i)||1});var o=n*(s+1);e(t).css("height",o)}})(jQuery);(function(e){function r(){s();u()}function s(){e("a.comment-close").live("click",function(t){t.preventDefault();f(e(this).attr("id").substring(2))});e("a.vote").live("click",function(t){t.preventDefault();S(e(this))});e("a.reply").live("click",function(t){t.preventDefault();x(e(this).attr("id").substring(2))});e("a.close-reply").live("click",function(t){t.preventDefault();T(e(this).attr("id").substring(2))});e("a.sort-option").live("click",function(t){t.preventDefault();E(e(this))});e("a.show-proposal").live("click",function(t){t.preventDefault();m(e(this).attr("id").substring(2))});e("a.hide-proposal").live("click",function(t){t.preventDefault();g(e(this).attr("id").substring(2))});e("a.show-propose-change").live("click",function(t){t.preventDefault();y(e(this).attr("id").substring(2))});e("a.hide-propose-change").live("click",function(t){t.preventDefault();b(e(this).attr("id").substring(2))});e("a.accept-comment").live("click",function(t){t.preventDefault();d(e(this).attr("id").substring(2))});e("a.delete-comment").live("click",function(t){t.preventDefault();v(e(this).attr("id").substring(2))});e("a.comment-markup").live("click",function(t){t.preventDefault();w(e(this).attr("id").substring(2))})}function o(){if(n.substring(0,3)=="asc"){var r=n.substring(3);t=function(e,t){return e[r]-t[r]}}else t=function(e,t){return t[n]-e[n]};e("a.sel").attr("href","#").removeClass("sel");e("a.by"+n).removeAttr("href").addClass("sel")}function u(){n="rating";if(document.cookie.length>0){var e=document.cookie.indexOf("sortBy=");if(e!=-1){e+=7;var t=document.cookie.indexOf(";",e);if(t==-1){t=document.cookie.length;n=unescape(document.cookie.substring(e,t))}}}o()}function a(t){e("#ao"+t).hide();e("#ah"+t).show();var r=e.extend({id:t},O),i=e(L(M,r)).hide();i.find('textarea[name="proposal"]').hide();i.find("a.by"+n).addClass("sel");var s=i.find("#cf"+t);s.submit(function(e){e.preventDefault();c(s)});e("#s"+t).after(i);i.slideDown("fast",function(){l(t)})}function f(t){e("#ah"+t).hide();e("#ao"+t).show();var n=e("#sc"+t);n.slideUp("fast",function(){n.remove()})}function l(t){e.ajax({type:"GET",url:O.getCommentsURL,data:{node:t},success:function(n,r,i){var s=e("#cl"+t),o=100;e("#cf"+t).find('textarea[name="proposal"]').data("source",n.source);if(n.comments.length===0){s.html("<li>No comments yet.</li>");s.data("empty",!0)}else{var u=N(n.comments);o=n.comments.length*100;h(u,s);s.data("empty",!1)}e("#cn"+t).slideUp(o+200);s.slideDown(o)},error:function(e,t,n){A("Oops, there was a problem retrieving the comments.")},dataType:"json"})}function c(t){var n=t.find('input[name="node"]').val(),r=t.find('input[name="parent"]').val(),i=t.find('textarea[name="comment"]').val(),s=t.find('textarea[name="proposal"]').val();if(i==""){A("Please enter a comment.");return}t.find("textarea,input").attr("disabled","disabled");e.ajax({type:"POST",url:O.addCommentURL,dataType:"json",data:{node:n,parent:r,text:i,proposal:s},success:function(i,s,o){n&&b(n);t.find("textarea").val("").add(t.find("input")).removeAttr("disabled");var u=e("#cl"+(n||r));if(u.data("empty")){e(u).empty();u.data("empty",!1)}p(i.comment);var a=e("#ao"+n);a.find("img").attr({src:O.commentBrightImage});n&&e("#ca"+n).slideUp()},error:function(e,n,r){t.find("textarea,input").removeAttr("disabled");A("Oops, there was a problem adding the comment.")}})}function h(t,n){e.each(t,function(){var t=k(this);n.append(e(document.createElement("li")).html(t));h(this.children,t.find("ul.comment-children"));this.children=null;t.data("comment",this)})}function p(n){var r=k(n);n.children=null;r.data("comment",n);var s=e("#cl"+(n.node||n.parent)),o=C(s),u=e(document.createElement("li"));u.hide();for(i=0;i<o.length;i++)if(t(n,o[i])<=0){e("#cd"+o[i].id).parent().before(u.html(r));u.slideDown("fast");return}s.append(u.html(r));u.slideDown("fast")}function d(t){e.ajax({type:"POST",url:O.acceptCommentURL,data:{id:t},success:function(n,r,i){e("#cm"+t).fadeOut("fast");e("#cd"+t).removeClass("moderate")},error:function(e,t,n){A("Oops, there was a problem accepting the comment.")}})}function v(t){e.ajax({type:"POST",url:O.deleteCommentURL,data:{id:t},success:function(n,r,i){var s=e("#cd"+t);if(n=="delete"){s.slideUp("fast",function(){s.remove()});return}s.find("span.user-id:first").text("[deleted]").end().find("div.comment-text:first").text("[deleted]").end().find("#cm"+t+", #dc"+t+", #ac"+t+", #rc"+t+", #sp"+t+", #hp"+t+", #cr"+t+", #rl"+t).remove();var o=s.data("comment");o.username="[deleted]";o.text="[deleted]";s.data("comment",o)},error:function(e,t,n){A("Oops, there was a problem deleting the comment.")}})}function m(t){e("#sp"+t).hide();e("#hp"+t).show();e("#pr"+t).slideDown("fast")}function g(t){e("#hp"+t).hide();e("#sp"+t).show();e("#pr"+t).slideUp("fast")}function y(t){e("#pc"+t).hide();e("#hc"+t).show();var n=e("#pt"+t);n.val(n.data("source"));e.fn.autogrow.resize(n[0]);n.slideDown("fast")}function b(t){e("#hc"+t).hide();e("#pc"+t).show();var n=e("#pt"+t);n.val("").removeAttr("disabled");n.slideUp("fast")}function w(t){e("#mb"+t).toggle()}function E(t){var r=t.attr("class").split(/\s+/);for(var i=0;i<r.length;i++)r[i]!="sort-option"&&(n=r[i].substring(2));o();var s=new Date;s.setDate(s.getDate()+365);document.cookie="sortBy="+escape(n)+";expires="+s.toUTCString();e("ul.comment-ul").each(function(t,n){var r=C(e(n),!0);r=N(r);h(r,e(n).empty())})}function S(t){if(!O.voting){A("You'll need to login to vote.");return}var n=t.attr("id");if(!n)return;var r=0;n.charAt(1)!="u"&&(r=n.charAt(0)=="u"?1:-1);var i={comment_id:n.substring(2),value:r};t.hide();e("#"+n.charAt(0)+(n.charAt(1)=="u"?"v":"u")+i.comment_id).show();var s=e("div#cd"+i.comment_id),o=s.data("comment");if(i.value!==0&&o.vote===i.value*-1){e("#"+(i.value==1?"d":"u")+"u"+i.comment_id).hide();e("#"+(i.value==1?"d":"u")+"v"+i.comment_id).show()}o.rating+=o.vote===0?i.value:i.value-o.vote;o.vote=i.value;s.data("comment",o);s.find(".rating:first").text(o.rating+" point"+(o.rating==1?"":"s"));e.ajax({type:"POST",url:O.processVoteURL,data:i,error:function(e,t,n){A("Oops, there was a problem casting that vote.")}})}function x(t){e("#rl"+t).hide();e("#cr"+t).show();var n=e(L(D,{id:t})).hide();e("#cl"+t).prepend(n).find("#rf"+t).submit(function(n){n.preventDefault();c(e("#rf"+t));T(t)}).find("input[type=button]").click(function(){T(t)});n.slideDown("fast",function(){e("#rf"+t).find("textarea").focus()})}function T(t){e("#rd"+t).slideUp("fast",function(){e(this).remove()});e("#cr"+t).hide();e("#rl"+t).show()}function N(n){n.sort(t);e.each(n,function(){this.children=N(this.children)});return n}function C(t,n){var r=[];t.children().children("[id^='cd']").each(function(){var t=e(this).data("comment");n&&(t.children=C(e(this).find("#cl"+t.id),!0));r.push(t)});return r}function k(t){if(!t.displayed&&!O.moderator)return e('<div class="moderate">Thank you!  Your comment will show up once it is has been approved by a moderator.</div>');t.pretty_rating=t.rating+" point"+(t.rating==1?"":"s");t.css_class=t.displayed?"":" moderate";var n=e.extend({},O,t),r=e(L(_,n));if(t.vote){var i=t.vote==1?"u":"d";r.find("#"+i+"v"+t.id).hide();r.find("#"+i+"u"+t.id).show()}if(O.moderator||t.text!="[deleted]"){r.find("a.reply").show();t.proposal_diff&&r.find("#sp"+t.id).show();O.moderator&&!t.displayed&&r.find("#cm"+t.id).show();(O.moderator||O.username==t.username)&&r.find("#dc"+t.id).show()}return r}function L(t,n){function i(t,i){var s=n;e.each(t.split("."),function(){s=s[this]});return i?r.text(s||"").html():s}var r=e(document.createElement("div"));return t.replace(/<([%#])([\w\.]*)\1>/g,function(){return i(arguments[2],arguments[1]=="%"?!0:!1)})}function A(t){e(document.createElement("div")).attr({"class":"popup-error"}).append(e(document.createElement("div")).attr({"class":"error-message"}).text(t)).appendTo("body").fadeIn("slow").delay(2e3).fadeOut("slow")}var t,n;e.fn.comment=function(){return this.each(function(){var t=e(this).attr("id").substring(1),n=COMMENT_METADATA[t],r=n+" comment"+(n==1?"":"s"),i=n>0?O.commentBrightImage:O.commentImage,s=n==0?" nocomment":"";e(this).append(e(document.createElement("a")).attr({href:"#","class":"sphinx-comment-open"+s,id:"ao"+t}).append(e(document.createElement("img")).attr({src:i,alt:"comment",title:r})).click(function(t){t.preventDefault();a(e(this).attr("id").substring(2))})).append(e(document.createElement("a")).attr({href:"#","class":"sphinx-comment-close hidden",id:"ah"+t}).append(e(document.createElement("img")).attr({src:O.closeCommentImage,alt:"close",title:"close"})).click(function(t){t.preventDefault();f(e(this).attr("id").substring(2))}))})};var O={processVoteURL:"/_process_vote",addCommentURL:"/_add_comment",getCommentsURL:"/_get_comments",acceptCommentURL:"/_accept_comment",deleteCommentURL:"/_delete_comment",commentImage:"/static/_static/comment.png",closeCommentImage:"/static/_static/comment-close.png",loadingImage:"/static/_static/ajax-loader.gif",commentBrightImage:"/static/_static/comment-bright.png",upArrow:"/static/_static/up.png",downArrow:"/static/_static/down.png",upArrowPressed:"/static/_static/up-pressed.png",downArrowPressed:"/static/_static/down-pressed.png",voting:!1,moderator:!1};typeof COMMENT_OPTIONS!="undefined"&&(O=jQuery.extend(O,COMMENT_OPTIONS));var M='    <div class="sphinx-comments" id="sc<%id%>">      <p class="sort-options">        Sort by:        <a href="#" class="sort-option byrating">best rated</a>        <a href="#" class="sort-option byascage">newest</a>        <a href="#" class="sort-option byage">oldest</a>      </p>      <div class="comment-header">Comments</div>      <div class="comment-loading" id="cn<%id%>">        loading comments... <img src="<%loadingImage%>" alt="" /></div>      <ul id="cl<%id%>" class="comment-ul"></ul>      <div id="ca<%id%>">      <p class="add-a-comment">Add a comment        (<a href="#" class="comment-markup" id="ab<%id%>">markup</a>):</p>      <div class="comment-markup-box" id="mb<%id%>">        reStructured text markup: <i>*emph*</i>, <b>**strong**</b>,         <tt>``code``</tt>,         code blocks: <tt>::</tt> and an indented block after blank line</div>      <form method="post" id="cf<%id%>" class="comment-form" action="">        <textarea name="comment" cols="80"></textarea>        <p class="propose-button">          <a href="#" id="pc<%id%>" class="show-propose-change">            Propose a change &#9657;          </a>          <a href="#" id="hc<%id%>" class="hide-propose-change">            Propose a change &#9663;          </a>        </p>        <textarea name="proposal" id="pt<%id%>" cols="80"                  spellcheck="false"></textarea>        <input type="submit" value="Add comment" />        <input type="hidden" name="node" value="<%id%>" />        <input type="hidden" name="parent" value="" />      </form>      </div>    </div>',_='    <div id="cd<%id%>" class="sphinx-comment<%css_class%>">      <div class="vote">        <div class="arrow">          <a href="#" id="uv<%id%>" class="vote" title="vote up">            <img src="<%upArrow%>" />          </a>          <a href="#" id="uu<%id%>" class="un vote" title="vote up">            <img src="<%upArrowPressed%>" />          </a>        </div>        <div class="arrow">          <a href="#" id="dv<%id%>" class="vote" title="vote down">            <img src="<%downArrow%>" id="da<%id%>" />          </a>          <a href="#" id="du<%id%>" class="un vote" title="vote down">            <img src="<%downArrowPressed%>" />          </a>        </div>      </div>      <div class="comment-content">        <p class="tagline comment">          <span class="user-id"><%username%></span>          <span class="rating"><%pretty_rating%></span>          <span class="delta"><%time.delta%></span>        </p>        <div class="comment-text comment"><#text#></div>        <p class="comment-opts comment">          <a href="#" class="reply hidden" id="rl<%id%>">reply &#9657;</a>          <a href="#" class="close-reply" id="cr<%id%>">reply &#9663;</a>          <a href="#" id="sp<%id%>" class="show-proposal">proposal &#9657;</a>          <a href="#" id="hp<%id%>" class="hide-proposal">proposal &#9663;</a>          <a href="#" id="dc<%id%>" class="delete-comment hidden">delete</a>          <span id="cm<%id%>" class="moderation hidden">            <a href="#" id="ac<%id%>" class="accept-comment">accept</a>          </span>        </p>        <pre class="proposal" id="pr<%id%>"><#proposal_diff#>        </pre>          <ul class="comment-children" id="cl<%id%>"></ul>        </div>        <div class="clearleft"></div>      </div>    </div>',D='    <li>      <div class="reply-div" id="rd<%id%>">        <form id="rf<%id%>">          <textarea name="comment" cols="80"></textarea>          <input type="submit" value="Add reply" />          <input type="button" value="Cancel" />          <input type="hidden" name="parent" value="<%id%>" />          <input type="hidden" name="node" value="" />        </form>      </div>    </li>';e(document).ready(function(){r()})})(jQuery);$(document).ready(function(){$(".sphinx-has-comment").comment();$("div.context").each(function(){var e=$.getQueryParameters(),t=e.q?e.q[0].split(/\s+/):[],n=$(this);$.each(t,function(){n.highlightText(this.toLowerCase(),"highlighted")})});var e=document.location.hash;if(e.substring(0,9)=="#comment-"){$("#ao"+e.substring(9)).click();document.location.hash="#s"+e.substring(9)}});